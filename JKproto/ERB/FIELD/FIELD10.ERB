;*************************************************
;@PLACE_SET_1 場所の属性
;SETBIT DA:1:0,0 は内部の存在判定に使ってますので消さないで下さい
;SETBIT DA:1:部屋番号,0 外に出れる場所
;SETBIT DA:1:部屋番号,1 中に入れる場所
;SETBIT DA:1:部屋番号,2 電車に乗れる場所
;SETBIT DA:1:部屋番号,3 屋内
;SETBIT DA:1:部屋番号,4 遊技場あり
;SETBIT DA:1:部屋番号,5 注文可

;SETBIT DA:1:部屋番号,7 買い物可
;SETBIT DA:1:部屋番号,8 打工可
;SETBIT DA:1:部屋番号,9 鍵が掛かってる
;SETBIT DA:0:部屋番号,10 ＮＰＣが自慰出来る場所
;*************************************************
@PLACE_SET_1
SETBIT DA:1:0,0
SETBIT DA:1:1,0

SETBIT DA:1:2,3
SETBIT DA:1:4,3
SETBIT DA:1:5,3
SETBIT DA:1:6,3
SETBIT DA:1:7,3
SETBIT DA:1:8,3
SETBIT DA:1:9,3
SETBIT DA:1:10,3
SETBIT DA:1:11,3
SETBIT DA:1:15,3
SETBIT DA:1:16,3
SETBIT DA:1:17,3
SETBIT DA:1:30,3

SETBIT DA:1:18,3
SETBIT DA:1:19,3
SETBIT DA:1:20,3
SETBIT DA:1:21,3
SETBIT DA:1:22,3
SETBIT DA:1:23,3
SETBIT DA:1:24,3
SETBIT DA:1:25,3
SETBIT DA:1:26,3
SETBIT DA:1:27,3
SETBIT DA:1:28,3
SETBIT DA:1:29,3

SETBIT DA:1:7,7
SETBIT DA:1:26,7

SETBIT DA:1:6,10
SETBIT DA:1:7,10
SETBIT DA:1:10,10
SETBIT DA:1:11,10
SETBIT DA:1:12,10
SETBIT DA:1:15,10
SETBIT DA:1:17,10
SETBIT DA:1:21,10
SETBIT DA:1:22,10
SETBIT DA:1:23,10
SETBIT DA:1:24,10
SETBIT DA:1:30,10

;*************************************************
;@PLACE_NAME_1(ARG) 場所名
;CASE 場所番号
;	PRINT 場所名
;*************************************************

@PLACE_NAME_1(ARG)
#FUNCTIONS
SELECTCASE ARG

	CASE 1
		RETURNF "校門"
	CASE 2
		RETURNF "２年教室"
	CASE 3
		RETURNF "昇降口"
	CASE 4
		RETURNF "職員室"
	CASE 5
		RETURNF "校長室"
	CASE 6
		RETURNF "学生指导处"
	CASE 7
		RETURNF "保健室"
	CASE 8
		RETURNF "１年教室"
	CASE 9
		RETURNF "３年教室"
	CASE 10
		RETURNF "厕所"
	CASE 11
		RETURNF "図書室"
	CASE 12
		RETURNF "屋上"
	CASE 13
		RETURNF "校庭"
	CASE 14
		RETURNF "游泳池"
	CASE 15
		RETURNF "社团活动楼"
	CASE 16
		RETURNF "体育館"
	CASE 17
		RETURNF "体育倉庫"
	CASE 18
		RETURNF "西廊下"
	CASE 19
		RETURNF "走廊"
	CASE 20
		RETURNF "学生会办公室"
	CASE 21
		RETURNF "美術室"
	CASE 22
		RETURNF "音楽室"
	CASE 23
		RETURNF "化学室"
	CASE 24
		RETURNF "家庭科室"
	CASE 25
		RETURNF "食堂"
	CASE 26
		RETURNF "小卖部"
	CASE 27
		RETURNF "北廊下"
	CASE 28
		RETURNF "南廊下"
	CASE 29
		RETURNF "東廊下"
	CASE 30
		RETURNF "学生宿舍"

ENDSELECT
@PLACE_CROWDED_1(ARG)
VARSET LOCAL
RETURN 100

SELECTCASE ARG
	CASE 1,14
		RETURN 0
	CASE 3,4
		RETURN 100
	CASEELSE
		RETURN 30
ENDSELECT

;*************************************************
;@CAN_MOVE_1(ARG,ARG:1) 移動可能判定
;CASE 現在位置
;	SIF ARG:1 == 移動候補
;		RETURN 1 移動可 RETURN 2 移動と視認可
;*************************************************

@CAN_MOVE_1(ARG,ARG:1)
;RETURN 移動に掛かる時間,返し値がない場合は移動不可
SELECTCASE ARG
	;校門
	CASE 1
		SIF ARG:1 == 3
			RETURN 2
		SIF ARG:1 == 13
			RETURN 2
		SIF ARG:1 == 30
			RETURN 2
	;２年教室
	CASE 2
		SIF ARG:1 == 18
			RETURN 1
	;昇降口
	CASE 3
		SIF ARG:1 == 1
			RETURN 2
		SIF ARG:1 == 13
			RETURN 2
		SIF ARG:1 == 27
			RETURN 1
		SIF ARG:1 == 29
			RETURN 1
		SIF ARG:1 == 30
			RETURN 2

	;職員室
	CASE 4
		SIF ARG:1 == 29
			RETURN 1
	;校長室
	CASE 5
		SIF ARG:1 == 29
			RETURN 1
	;学生指导处
	CASE 6
		SIF ARG:1 == 29
			RETURN 1
	;保健室
	CASE 7
		SIF ARG:1 == 29
			RETURN 1
	;１年教室
	CASE 8
		SIF ARG:1 == 18
			RETURN 1
	;３年教室
	CASE 9
		SIF ARG:1 == 18
			RETURN 1
	;厕所
	CASE 10
		SIF ARG:1 == 18
			RETURN 1
	;図書室
	CASE 11
		SIF ARG:1 == 18
			RETURN 1
		SIF ARG:1 == 28
			RETURN 1

	;屋上
	CASE 12
		SIF ARG:1 == 18
			RETURN 1
		SIF ARG:1 == 27
			RETURN 1

	;校庭
	CASE 13
		SIF ARG:1 == 1
			RETURN 2
		SIF ARG:1 == 3
			RETURN 2
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 19
			RETURN 2
		SIF ARG:1 == 30
			RETURN 2

	;游泳池
	CASE 14
		SIF ARG:1 == 13
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 19
			RETURN 1

	;社团活动楼
	CASE 15
		SIF ARG:1 == 13
			RETURN 1
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 19
			RETURN 2

	;体育館
	CASE 16
		SIF ARG:1 == 13
			RETURN 1
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 19
			RETURN 1
	;体育倉庫
	CASE 17
		SIF ARG:1 == 13
			RETURN 1
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 19
			RETURN 2

	;西廊下
	CASE 18
		SIF ARG:1 == 2
			RETURN 1
		SIF ARG:1 == 8
			RETURN 1
		SIF ARG:1 == 9
			RETURN 1
		SIF ARG:1 == 10
			RETURN 1
		SIF ARG:1 == 11
			RETURN 1
		SIF ARG:1 == 12
			RETURN 1
		SIF ARG:1 == 27
			RETURN 1
		SIF ARG:1 == 28
			RETURN 1

	;走廊
	CASE 19
		SIF ARG:1 == 13
			RETURN 2
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 28
			RETURN 1
		SIF ARG:1 == 29
			RETURN 1

	;学生会办公室
	CASE 20
		SIF ARG:1 == 29
			RETURN 1
	;美術室
	CASE 21
		SIF ARG:1 == 28
			RETURN 1
	;音楽室
	CASE 22
		SIF ARG:1 == 28
			RETURN 1
	;化学室
	CASE 23
		SIF ARG:1 == 29
			RETURN 1
	;家庭科室
	CASE 24
		SIF ARG:1 == 29
			RETURN 1
	;食堂
	CASE 25
		SIF ARG:1 == 27
			RETURN 1
	;小卖部
	CASE 26
		SIF ARG:1 == 27
			RETURN 1
	;北廊下
	CASE 27
		SIF ARG:1 == 3
			RETURN 1
		SIF ARG:1 == 18
			RETURN 1
		SIF ARG:1 == 29
			RETURN 1
		SIF ARG:1 == 12
			RETURN 1
		SIF ARG:1 == 25
			RETURN 1
		SIF ARG:1 == 26
			RETURN 1

	;南廊下
	CASE 28
		SIF ARG:1 == 18
			RETURN 1
		SIF ARG:1 == 29
			RETURN 1
		SIF ARG:1 == 19
			RETURN 1
		SIF ARG:1 == 11
			RETURN 1
		SIF ARG:1 == 21
			RETURN 1
		SIF ARG:1 == 22
			RETURN 1

	;東廊下
	CASE 29
		SIF ARG:1 == 27
			RETURN 1
		SIF ARG:1 == 28
			RETURN 1
		SIF ARG:1 == 3
			RETURN 1
		SIF ARG:1 == 4
			RETURN 1
		SIF ARG:1 == 5
			RETURN 1
		SIF ARG:1 == 6
			RETURN 1
		SIF ARG:1 == 7
			RETURN 1
		SIF ARG:1 == 20
			RETURN 1
		SIF ARG:1 == 23
			RETURN 1
		SIF ARG:1 == 24
			RETURN 1
		SIF ARG:1 == 19
			RETURN 1
	;学生宿舍
	CASE 30
		SIF ARG:1 == 1
			RETURN 2
		SIF ARG:1 == 3
			RETURN 2
		SIF ARG:1 == 13
			RETURN 2


ENDSELECT
;*************************************************
;@FARMOVE_1(ARG,ARG:1) 遠距離移動
;LOCAL:0 現在の位置
;LOCAL:1 暫定目的地
;ARG 移動するキャラ番号
;ARG:1 最終目的地
;RETURN 今回移動するところ
;*************************************************

@FARMOVE_1(ARG,ARG:1)
;現在位置取得
LOCAL:0 = CFLAG:ARG:現在位置

;暫定目的地決定
LOCAL:1 = ARG:1
;;;$LOOP
;暫定目的地に直接移動できる場合
CALLFORM CAN_MOVE_{CFLAG:ARG:現在地区}(CFLAG:ARG:現在位置,LOCAL:1)
IF RESULT
	;そこに移動
	RETURNFORM {LOCAL:1}
ENDIF

;袋小路から行ける場所は固定なので、そこを目指す
IF (LOCAL:0 == 2)
	RETURN 18
ENDIF

IF (LOCAL:0 == 4)
	RETURN 29
ENDIF
IF (LOCAL:0 == 5)
	RETURN 29
ENDIF
IF (LOCAL:0 == 6)
	RETURN 29
ENDIF
IF (LOCAL:0 == 7)
	RETURN 29
ENDIF
IF (LOCAL:0 == 8)
	RETURN 18
ENDIF
IF (LOCAL:0 == 9)
	RETURN 18
ENDIF
IF (LOCAL:0 == 10)
	RETURN 18
ENDIF
IF (LOCAL:0 == 20)
	RETURN 29
ENDIF

IF (LOCAL:0 == 21)
	RETURN 28
ENDIF
IF (LOCAL:0 == 22)
	RETURN 28
ENDIF
IF (LOCAL:0 == 10)
	RETURN 29
ENDIF
IF (LOCAL:0 == 10)
	RETURN 29
ENDIF

IF (LOCAL:0 == 25)
	RETURN 27
ENDIF
IF (LOCAL:0 == 26)
	RETURN 27
ENDIF


;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
SELECTCASE LOCAL:0
CASE 1
	SELECTCASE LOCAL:1
		CASE 13,14,15,16,17,19
			RETURN 13
		CASE 30
			RETURN 30
		CASEELSE
			RETURN 3
	ENDSELECT
CASE 2
	RETURN 18
CASE 3
	SELECTCASE LOCAL:1
		CASE 13,14,15,16,17
			RETURN 13
		CASE 4,5,6,7,20,23,24,19,28,29,21,22,11
			RETURN 29
		CASE 12,25,26,27,18,8,2,10,9
			RETURN 27
		CASE 1
			RETURN 1
		CASE 30
			RETURN 30
	ENDSELECT

CASE 4
	RETURN 29
CASE 5
	RETURN 29
CASE 6
	RETURN 29
CASE 7
	RETURN 29
CASE 8
	RETURN 18
CASE 9
	RETURN 18
CASE 10
	RETURN 18
CASE 11
	SELECTCASE LOCAL:1
		CASE 1,3,18,26,27,25,12,8,2,10,9,30
			RETURN 18
		CASEELSE
			RETURN 28
	ENDSELECT
CASE 12
	SELECTCASE LOCAL:1
		CASE 8,2,10,9,11,18,21,22,28
			RETURN 18
		CASEELSE
			RETURN 27
	ENDSELECT
CASE 13
	SELECTCASE LOCAL:1
		CASE 11,19,21,22,28
			RETURN 19
		CASE 30
			RETURN 30
		CASEELSE
			RETURN 3
	ENDSELECT
CASE 14
	IF LOCAL:1 == 1 || LOCAL:1 == 3 || LOCAL:1 == 30
		RETURN 13
	ELSE
		RETURN 19
	ENDIF
CASE 15
	IF LOCAL:1 == 1 || LOCAL:1 == 3 || LOCAL:1 == 30
		RETURN 13
	ELSE
		RETURN 19
	ENDIF
CASE 16
	IF LOCAL:1 == 1 || LOCAL:1 == 3 || LOCAL:1 == 30
		RETURN 13
	ELSE
		RETURN 19
	ENDIF
CASE 17
	IF LOCAL:1 == 1 || LOCAL:1 == 3 || LOCAL:1 == 30
		RETURN 13
	ELSE
		RETURN 19
	ENDIF
CASE 18
	SELECTCASE LOCAL:1
		CASE 25,26,27,3,1,13,30
			RETURN 27
		CASEELSE
			RETURN 28
	ENDSELECT
CASE 19
	SELECTCASE LOCAL:1
		CASE 1,13,30
			RETURN 13
		CASE 3,4,5,6,7,20,23,24,12,25,26,27,29
			RETURN 29
		CASEELSE
			RETURN 28
	ENDSELECT

CASE 20
	RETURN 29
CASE 21
	RETURN 28
CASE 22
	RETURN 28
CASE 23
	RETURN 29
CASE 24
	RETURN 29
CASE 25
	RETURN 27
CASE 26
	RETURN 27
CASE 27
	SELECTCASE LOCAL:1
		CASE 1,3,13,15,17,14,16,30
			RETURN 3
		CASE 4,5,6,7,20,23,24,19,21,22,28,29
			RETURN 29
		CASEELSE
			RETURN 18
	ENDSELECT
CASE 28
	SELECTCASE LOCAL:1
		CASE 12,8,10,2,9,18
			RETURN 18
		CASE 15,17,16,14,19
			RETURN 19
		CASEELSE
			RETURN 29
	ENDSELECT
CASE 29
	SELECTCASE LOCAL:1
		CASE 1,3,13,30
			RETURN 3
		CASE 12,25,26,27,8,18,2,10,9
			RETURN 27
		CASE 14,15,16,17,19
			RETURN 19
		CASEELSE
			RETURN 28
	ENDSELECT
CASE 30
	SELECTCASE LOCAL:1
		CASE 1
			RETURN 1
		CASE 13,14,15,16,17,19
			RETURN 13
		CASEELSE
			RETURN 3
	ENDSELECT

ENDSELECT
;;;GOTO LOOP


;*************************************************
;@GET_MAP_1 マップ表示
;各地区で表示したいマップを記入して下さい。
;*************************************************

@GET_MAP_1

PRINT ■■■■■■■■■■■■■■■■■■■■■■
PRINTBUTTON (MAP_NAME_BUTTON(1,1)),1
PRINTBUTTON (MAP_NAME_BUTTON(1,15)),15
PRINTBUTTON (MAP_NAME_BUTTON(1,29)),29
PRINTL 
PRINT ■■
CALL GETMAP(12)
PRINT ■■
CALL GETMAP(25)
PRINT ■
CALL GETMAP(26)
PRINT ■■■■■■■■■■■■■■
PRINTBUTTON (MAP_NAME_BUTTON(1,2)),2
PRINTBUTTON (MAP_NAME_BUTTON(1,16)),16
PRINTBUTTON (MAP_NAME_BUTTON(1,30)),30
PRINTL 
PRINT ■■□□□□
CALL GETMAP(27)
PRINT □□□
CALL GETMAP(3)
PRINT □□□□□□□□□□
CALL GETMAP(1)
PRINTBUTTON (MAP_NAME_BUTTON(1,3)),3
PRINTBUTTON (MAP_NAME_BUTTON(1,17)),17
PRINTL 
PRINT ■■□■■■■■□■■■■■■■□■■■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,4)),4
PRINTBUTTON (MAP_NAME_BUTTON(1,18)),18
PRINTL 
PRINT ■
CALL GETMAP(8)
PRINT □■■■■
CALL GETMAP(5)
PRINT □
CALL GETMAP(4)
PRINT ■■■■■□□□■■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,5)),5
PRINTBUTTON (MAP_NAME_BUTTON(1,19)),19
PRINTL 
PRINT ■■
CALL GETMAP(18)
PRINT ■■■■■□■■■■■□□□□□■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,6)),6
PRINTBUTTON (MAP_NAME_BUTTON(1,20)),20
PRINTL 
PRINT ■
CALL GETMAP(2)
PRINT □
CALL GETMAP(10)
PRINT ■■■
CALL GETMAP(6)
PRINT □
CALL GETMAP(7)
PRINT ■■■■□□
CALL GETMAP(13)
PRINT □□■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,7)),7
PRINTBUTTON (MAP_NAME_BUTTON(1,21)),21
PRINTL 
PRINT ■■□■■■■■
CALL GETMAP(29)
PRINT ■■■■■□□□□□■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,8)),8
PRINTBUTTON (MAP_NAME_BUTTON(1,22)),22
PRINTL 
PRINT ■
CALL GETMAP(9)
PRINT □■■■■
CALL GETMAP(20)
PRINT □
CALL GETMAP(23)
PRINT ■■■■■□□□■■■□
PRINTBUTTON (MAP_NAME_BUTTON(1,9)),9
PRINTBUTTON (MAP_NAME_BUTTON(1,23)),23
PRINTL 
PRINT ■■□■■■■■□■■■■■■■□■■■
CALL GETMAP(30)
PRINT □
PRINTBUTTON (MAP_NAME_BUTTON(1,10)),10
PRINTBUTTON (MAP_NAME_BUTTON(1,24)),24
PRINTL 
PRINT ■■□■■■■■□
CALL GETMAP(24)
PRINT ■
CALL GETMAP(16)
PRINT □
CALL GETMAP(14)
PRINT ■
CALL GETMAP(15)
PRINT □
CALL GETMAP(17)
PRINT ■■□□
PRINTBUTTON (MAP_NAME_BUTTON(1,11)),11
PRINTBUTTON (MAP_NAME_BUTTON(1,25)),25
PRINTL 
PRINT ■
CALL GETMAP(11)
PRINT □■
CALL GETMAP(21)
PRINT ■
CALL GETMAP(22)
PRINT ■□■■■□■■■□■■■□□
PRINTBUTTON (MAP_NAME_BUTTON(1,12)),12
PRINTBUTTON (MAP_NAME_BUTTON(1,26)),26
PRINTL 
PRINT ■■□□□
CALL GETMAP(28)
PRINT □□□□
CALL GETMAP(19)
PRINT □□□□□□■■■□□
PRINTBUTTON (MAP_NAME_BUTTON(1,13)),13
PRINTBUTTON (MAP_NAME_BUTTON(1,27)),27
PRINTL 
PRINT ■■■■■■■■■■■■■■■■■■■■■■
PRINTBUTTON (MAP_NAME_BUTTON(1,14)),14
PRINTBUTTON (MAP_NAME_BUTTON(1,28)),28
PRINTL 
PRINTL 
