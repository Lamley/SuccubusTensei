;*************************************************
;@PLACE_SET_2 場所の属性
;SETBIT DA:2:0,0 は内部の存在判定に使ってますので消さないで下さい
;SETBIT DA:2:部屋番号,0 外に出れる場所
;SETBIT DA:2:部屋番号,1 中に入れる場所
;SETBIT DA:2:部屋番号,2 電車に乗れる場所
;SETBIT DA:2:部屋番号,3 屋内
;SETBIT DA:2:部屋番号,4 遊技場あり
;SETBIT DA:2:部屋番号,5 注文可
;SETBIT DA:2:部屋番号,7 買い物可
;SETBIT DA:2:部屋番号,8 打工可
;SETBIT DA:2:部屋番号,9 鍵が掛かってる
;SETBIT DA:0:部屋番号,10 ＮＰＣが自慰出来る場所
;*************************************************
@PLACE_SET_2
SETBIT DA:2:0,0
SETBIT DA:2:1,1
SETBIT DA:2:3,2

SETBIT DA:2:5,3
SETBIT DA:2:6,3
SETBIT DA:2:7,3
SETBIT DA:2:8,3
SETBIT DA:2:9,3
SETBIT DA:2:10,3
SETBIT DA:2:11,3
SETBIT DA:2:12,3
SETBIT DA:2:13,3
SETBIT DA:2:14,3
SETBIT DA:2:15,3
SETBIT DA:2:16,3
SETBIT DA:2:19,3
SETBIT DA:2:20,3
SETBIT DA:2:21,3
SETBIT DA:2:25,3
SETBIT DA:2:26,3
SETBIT DA:2:27,3
SETBIT DA:2:28,3

SETBIT DA:2:7,4
SETBIT DA:2:8,4

SETBIT DA:2:6,5
SETBIT DA:2:14,5
SETBIT DA:2:12,5


SETBIT DA:2:9,7
SETBIT DA:2:10,7
SETBIT DA:2:15,7
SETBIT DA:2:20,7
SETBIT DA:2:21,7
SETBIT DA:2:24,7

SETBIT DA:2:5,8
SETBIT DA:2:6,8
SETBIT DA:2:7,8
SETBIT DA:2:8,8
SETBIT DA:2:9,8
SETBIT DA:2:10,8
SETBIT DA:2:12,8
SETBIT DA:2:14,8
SETBIT DA:2:15,8
SETBIT DA:2:16,8
SETBIT DA:2:19,8
SETBIT DA:2:20,8
SETBIT DA:2:21,8

SETBIT DA:2:26,9
SETBIT DA:2:28,9

SETBIT DA:2:7,10
SETBIT DA:2:8,10
SETBIT DA:2:14,10
SETBIT DA:2:17,10
;SETBIT DA:2:22,10
SETBIT DA:2:23,10
SETBIT DA:2:26,10

;*************************************************
;@PLACE_NAME_2(ARG) 場所名
;CASE 場所番号
;	PRINT 場所名
;*************************************************

@PLACE_NAME_2(ARG)
#FUNCTIONS
SELECTCASE ARG

	CASE 1
		RETURNF "学校"
	CASE 2
		RETURNF "上学的路"
	CASE 3
		RETURNF "学院前的车站"
	CASE 4
		RETURNF "繁華街"
	CASE 5
		RETURNF "便利店"
	CASE 6
		RETURNF "汉堡店"
	CASE 7
		RETURNF "卡拉OK店"
	CASE 8
		RETURNF "游戏中心"
	CASE 9
		RETURNF "服屋"
	CASE 10
		RETURNF "薬屋"
	CASE 11
		RETURNF "警察署"
	CASE 12
		RETURNF "家庭餐厅"
	CASE 13
		RETURNF "病院"
	CASE 14
		RETURNF "咖啡厅"
	CASE 15
		RETURNF "书店"
	CASE 16
		RETURNF "健身房"
	CASE 17
		RETURNF "公園"
	CASE 18
		RETURNF "后街"
	CASE 19
		RETURNF "夜总会"
	CASE 20
		RETURNF "成人商店"
	CASE 21
		RETURNF "装饰品店铺"
	CASE 22
		RETURNF "情人旅馆"
	CASE 23
		RETURNF "裏路地"
	CASE 24
		RETURNF "家電屋"
	CASE 25
		RETURNF "他校"
	CASE 26
		RETURNF "宿舍"
	CASE 27
		RETURNF "职业摔跤事务所"
	CASE 28
		RETURNF "格闘場"

ENDSELECT
@PLACE_CROWDED_2(ARG)
VARSET LOCAL
RETURN 100

SELECTCASE ARG
	CASE 1,14
		RETURN 0
	CASE 3,4
		RETURN 100
	CASEELSE
		RETURN 30
ENDSELECT

;*************************************************
;@CAN_MOVE_2(ARG,ARG:1) 移動可能判定
;CASE 現在位置
;	SIF ARG:1 == 移動候補
;		RETURN 1 移動可 RETURN 2 移動と視認可
;*************************************************

@CAN_MOVE_2(ARG,ARG:1)
;RETURN 移動に掛かる時間,返し値がない場合は移動不可
SELECTCASE ARG
	;学校
	CASE 1
		SIF ARG:1 == 2
			RETURN 5
	;上学的路
	CASE 2
		SIF ARG:1 == 1
			RETURN 5
		SIF ARG:1 == 3
			RETURN 5
		SIF ARG:1 == 17
			RETURN 1
		SIF ARG:1 == 25
			RETURN 5
		SIF ARG:1 == 26
			RETURN 1
	;学院前的车站
	CASE 3
		SIF ARG:1 == 2
			RETURN 5
		SIF ARG:1 == 4
			RETURN 3
	;繁華街
	CASE 4
		SIF ARG:1 == 3
			RETURN 3
		SIF ARG:1 == 18
			RETURN 5
		SIF ARG:1 == 5
			RETURN 1
		SIF ARG:1 == 6
			RETURN 1
		SIF ARG:1 == 7
			RETURN 1
		SIF ARG:1 == 8
			RETURN 1
		SIF ARG:1 == 9
			RETURN 1
		SIF ARG:1 == 10
			RETURN 1
		SIF ARG:1 == 11
			RETURN 1
		SIF ARG:1 == 12
			RETURN 1
		SIF ARG:1 == 13
			RETURN 1
		SIF ARG:1 == 14
			RETURN 1
		SIF ARG:1 == 15
			RETURN 1
		SIF ARG:1 == 16
			RETURN 1
		SIF ARG:1 == 21
			RETURN 1
		SIF ARG:1 == 24
			RETURN 1
		SIF ARG:1 == 27
			RETURN 5
		SIF ARG:1 == 28
			RETURN 5

	;便利店
	CASE 5
		SIF ARG:1 == 4
			RETURN 1
	;汉堡店
	CASE 6
		SIF ARG:1 == 4
			RETURN 1
	;卡拉OK店
	CASE 7
		SIF ARG:1 == 4
			RETURN 1
	;游戏中心
	CASE 8
		SIF ARG:1 == 4
			RETURN 1
	;服屋
	CASE 9
		SIF ARG:1 == 4
			RETURN 1
	;薬屋
	CASE 10
		SIF ARG:1 == 4
			RETURN 1
	;警察署
	CASE 11
		SIF ARG:1 == 4
			RETURN 1
	;家庭餐厅
	CASE 12
		SIF ARG:1 == 4
			RETURN 1
	;病院
	CASE 13
		SIF ARG:1 == 4
			RETURN 1
	;咖啡厅
	CASE 14
		SIF ARG:1 == 4
			RETURN 1
	;书店
	CASE 15
		SIF ARG:1 == 4
			RETURN 1
	;健身房
	CASE 16
		SIF ARG:1 == 4
			RETURN 1
	;公園
	CASE 17
		SIF ARG:1 == 2
			RETURN 1
	;后街
	CASE 18
		SIF ARG:1 == 4
			RETURN 5
		SIF ARG:1 == 19
			RETURN 1
		SIF ARG:1 == 20
			RETURN 1
		SIF ARG:1 == 22
			RETURN 1
		SIF ARG:1 == 23
			RETURN 5
		
	;夜总会
	CASE 19
		SIF ARG:1 == 18
			RETURN 1
	;成人商店
	CASE 20
		SIF ARG:1 == 18
			RETURN 1
	;装饰品店铺
	CASE 21
		SIF ARG:1 == 4
			RETURN 1
	;情人旅馆
	CASE 22
		SIF ARG:1 == 18
			RETURN 1
	;裏路地
	CASE 23
		SIF ARG:1 == 18
			RETURN 5
	;家電屋
	CASE 24
		SIF ARG:1 == 4
			RETURN 1
	;他校
	CASE 25
		SIF ARG:1 == 2
			RETURN 1
	;宿舍
	CASE 26
		SIF ARG:1 == 2
			RETURN 1
	;职业摔跤事务所
	CASE 27
		SIF ARG:1 == 4
			RETURN 5
		SIF ARG:1 == 28
			RETURN 1
	;格闘場
	CASE 28
		SIF ARG:1 == 4
			RETURN 5
		SIF ARG:1 == 27
			RETURN 1

ENDSELECT
;*************************************************
;@FARMOVE_2(ARG,ARG:1) 遠距離移動
;LOCAL:0 現在の位置
;LOCAL:1 暫定目的地
;ARG 移動するキャラ番号
;ARG:1 最終目的地
;RETURN 今回移動するところ
;*************************************************

@FARMOVE_2(ARG,ARG:1)
;現在位置取得
LOCAL:0 = CFLAG:ARG:現在位置
;暫定目的地決定
LOCAL:1 = ARG:1
$LOOP
;暫定目的地に直接移動できる場合
CALLFORM CAN_MOVE_{CFLAG:ARG:現在地区}(CFLAG:ARG:現在位置,LOCAL:1)
IF RESULT
	;そこに移動
	RETURNFORM {LOCAL:1}
ENDIF
;袋小路から行ける場所は固定なので、そこを目指す
SELECTCASE LOCAL:0
	CASE 1,17,25,26
		RETURN 2
	CASE 5,6,7,8,9,10,11,12,13,14,15,16,21,24,27,28
		RETURN 4
	CASE 19,20,22,23
		RETURN 18
ENDSELECT

;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
SELECTCASE LOCAL:1
CASE 1
	LOCAL:1 = 2
CASE 2
	LOCAL:1 = 3
CASE 3
	SELECTCASE LOCAL
		CASE 1,17,25,26
			LOCAL:1 = 2
		CASEELSE
			LOCAL:1 = 4
	ENDSELECT
CASE 4
	SELECTCASE LOCAL
		CASE 1,2,17,25,26
			LOCAL:1 = 3
		CASE 19,20
			LOCAL:1 = 18
	ENDSELECT
CASE 5
	LOCAL:1 = 4
CASE 6
	LOCAL:1 = 4
CASE 7
	LOCAL:1 = 4
CASE 8
	LOCAL:1 = 4
CASE 9
	LOCAL:1 = 4
CASE 10
	LOCAL:1 = 4
CASE 11
	LOCAL:1 = 4
CASE 12
	LOCAL:1 = 4
CASE 13
	LOCAL:1 = 4
CASE 14
	LOCAL:1 = 4
CASE 15
	LOCAL:1 = 4
CASE 16
	LOCAL:1 = 4
CASE 17
	LOCAL:1 = 2
CASE 18
	LOCAL:1 = 4
CASE 19
	LOCAL:1 = 18
CASE 20
	LOCAL:1 = 18
CASE 21
	LOCAL:1 = 4
CASE 22
	LOCAL:1 = 18
CASE 23
	LOCAL:1 = 18
CASE 24
	LOCAL:1 = 4
CASE 25
	LOCAL:1 = 2
CASE 26
	LOCAL:1 = 2
CASE 27
	LOCAL:1 = 4
CASE 28
	LOCAL:1 = 4

ENDSELECT
GOTO LOOP


;*************************************************
;@GET_MAP_2 マップ表示
;各地区で表示したいマップを記入して下さい。
;*************************************************

@GET_MAP_2


PRINT ■■■■■■■■■■■
CALL GETMAP(26)
PRINT ■■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,1)),1
PRINTBUTTON (MAP_NAME_BUTTON(2,18)),18
PRINTL 
CALL GETMAP(1)
PRINT □□□□
CALL GETMAP(2)
PRINT □□□□□□
CALL GETMAP(3)
PRINT ＝＝＝
PRINTBUTTON (MAP_NAME_BUTTON(2,2)),2
PRINTBUTTON (MAP_NAME_BUTTON(2,19)),19
PRINTL 
PRINT ■■■
CALL GETMAP(25)
PRINT ■■■■
CALL GETMAP(17)
PRINT ■■
CALL GETMAP(14)
PRINT □
CALL GETMAP(11)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,3)),3
PRINTBUTTON (MAP_NAME_BUTTON(2,20)),20
PRINTL 
PRINT ■■■■■■■■■■■■□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,4)),4
PRINTBUTTON (MAP_NAME_BUTTON(2,21)),21
PRINTL 
PRINT ■■■■■■■■■■■
CALL GETMAP(5)
PRINT □
CALL GETMAP(6)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,5)),5
PRINTBUTTON (MAP_NAME_BUTTON(2,22)),22
PRINTL 
PRINT ■■■■■■■■■■■■□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,6)),6
PRINTBUTTON (MAP_NAME_BUTTON(2,23)),23
PRINTL 
PRINT ■■■■■■■■■■■
CALL GETMAP(16)
PRINT □
CALL GETMAP(15)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,7)),7
PRINTBUTTON (MAP_NAME_BUTTON(2,24)),24

PRINTL 
PRINT ■■■■■■■■■■■■
CALL GETMAP(4)
PRINT ■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,8)),8
PRINTBUTTON (MAP_NAME_BUTTON(2,25)),25
PRINTL 
PRINT ■■■■■■■
CALL GETMAP(20)
PRINT □
CALL GETMAP(22)
PRINT ■
CALL GETMAP(7)
PRINT □
CALL GETMAP(8)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,9)),9
PRINTBUTTON (MAP_NAME_BUTTON(2,26)),26
PRINTL 
PRINT ■■■■■■■■□■■■□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,10)),10
PRINTBUTTON (MAP_NAME_BUTTON(2,27)),27
PRINTL 
PRINT ■■■■
CALL GETMAP(27)
PRINT ■■■□
CALL GETMAP(19)
PRINT ■
CALL GETMAP(9)
PRINT □
CALL GETMAP(10)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,11)),11
PRINTBUTTON (MAP_NAME_BUTTON(2,28)),28
PRINTL 
PRINT ■■■■□■■■
CALL GETMAP(18)
PRINT ■■■□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,12)),12
PRINTL 
PRINT ■■■■□□□□□□□□□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,13)),13
PRINTL 
PRINT ■■■■□■■■□■■
CALL GETMAP(21)
PRINT □
CALL GETMAP(12)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,14)),14
PRINTL 
PRINT ■■■■
CALL GETMAP(28)
PRINT ■■■□■■■□■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,15)),15
PRINTL 
PRINT ■■■■■■■■
CALL GETMAP(23)
PRINT ■■
CALL GETMAP(24)
PRINT □
CALL GETMAP(13)
PRINT ■■
PRINTBUTTON (MAP_NAME_BUTTON(2,16)),16
PRINTL 
PRINT ■■■■■■■■■■■■■■■■
PRINTBUTTON (MAP_NAME_BUTTON(2,17)),17
PRINTL 
PRINTL 