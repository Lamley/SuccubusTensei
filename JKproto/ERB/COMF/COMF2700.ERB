@COM_ABLE2700(ARG)
SIF !TFLAG:同室
	RETURN 0
RETURN GLOBAL_COMABLE(2700)

@COM2700(ARG)
VARSET LOCAL
PRINTL 
PRINTFORML %"=" * 107%
;强奸する
PRINTL 誰を强奸しますか？
FOR LOCAL,1,CHARANUM
	SIF LOCAL == 1
		CONTINUE
	SIF !TCVAR:LOCAL:同室 || CFLAG:LOCAL:睡眠 || CFLAG:LOCAL:衰弱 || CFLAG:LOCAL:会话
		CONTINUE
	PRINTFORML [{LOCAL,2}] - %CALLNAME:LOCAL%
NEXT
PRINTL [99] - 戻る
$INPUT_LOOP
INPUT
IF RESULT == 99
	RETURN 0
ELSEIF EXISTCSV(RESULT,0) && TCVAR:RESULT:同室
	J:114 = RESULT
	IF RAND(10) < 3
		PRINTFORML %CALLNAME:RESULT%に逃げられてしまった
		TA:1:(J:114):4 += 200
		TA:(J:114):1:3 -= 100
		TA:(J:114):1:6 += 500
		CFLAG:ARG:待機時間 += 10
		GOTO SELECTEND
	ELSEIF TA:(J:114):1:6 > 99 || ABL:(J:114):戦闘能力 || RAND(10) < 2
		PRINTFORML %CALLNAME:RESULT%が立ち向かってきた！
		F:100 = 1
		CALLFORM FIGHT1(ARG,J:114)
		J:117 = RESULT
		IF J:117 == 1
			PRINTFORML %CALLNAME:(J:114)%との戦闘に勝ちました
			IF TA:(J:114):ARG:3 > 0
				TA:(J:114):ARG:3 -= 100
			ELSE
				TA:(J:114):ARG:6 += 100
			ENDIF
			IF RAND(3)
				TA:ARG:(J:114):6 += 100
			ELSE
				TA:ARG:(J:114):6 -= 50
			ENDIF
			IF TALENT:(J:114):受虐狂 && RAND(4)
				TA:(J:114):ARG:0 += 20
				TA:(J:114):ARG:2 += 10
				TA:(J:114):ARG:3 += 50
				TA:(J:114):ARG:4 += 100
			ENDIF
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 += 3
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) -= 4
		ELSEIF J:117 == 2
			PRINTFORML %CALLNAME:(J:114)%との戦闘に負けました
			TA:ARG:(J:114):4 -= 100
			IF TA:ARG:(J:114):3 > 0
				TA:ARG:(J:114):3 -= 30
			ELSE
				TA:ARG:(J:114):6 += 30
			ENDIF
			IF RAND(2)
				TA:(J:114):ARG:6 += 80
			ELSE
				TA:(J:114):ARG:6 -= 20
			ENDIF
			IF TALENT:ARG:受虐狂 && RAND(4)
				TA:ARG:(J:114):0 += 20
				TA:ARG:(J:114):2 += 10
				TA:ARG:(J:114):3 += 50
				TA:ARG:(J:114):4 += 100
			ENDIF
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 -= 14
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) += 8
			BASE:ARG:評判 -= 30
			CFLAG:ARG:待機時間 += 10
			GOTO SELECTEND
		ELSEIF J:117 == 3
			PRINTFORML %CALLNAME:1%は逃げ出した
			TA:ARG:(J:114):4 -= 100
			IF TA:ARG:(J:114):3 > 0
				TA:ARG:(J:114):3 -= 30
			ELSE
				TA:ARG:(J:114):6 += 30
			ENDIF
			IF RAND(2)
				TA:(J:114):ARG:6 += 80
			ELSE
				TA:(J:114):ARG:6 -= 20
			ENDIF
;;;强奸逃げ時も加算
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 -= 12
			TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) += 7
			BASE:ARG:評判 -= 20
			CFLAG:ARG:待機時間 += 10
			GOTO SELECTEND
		ENDIF
	ENDIF
	PRINTFORML %CALLNAME:1%は%CALLNAME:(J:114)%を强奸している
	;調教
	J:115 = 1
	FLAG:タイマー = TIME + 28
	CALL EVENT_JOIN(ARG,J:114,7)
	CFLAG:ARG:待機時間 += 2
	TA:1:(J:114):0 += 10
	TA:1:(J:114):1 += 10
	TA:1:(J:114):2 -= 10
	TA:1:(J:114):3 += 100
	TA:1:(J:114):4 -= 300
	TA:1:(J:114):6 -= 10
	TA:(J:114):1:0 -= 10
	TA:(J:114):1:1 -= 10
	TA:(J:114):1:2 += 10
	TA:(J:114):1:3 -= 100
	TA:(J:114):1:4 -= 100
	TA:(J:114):1:6 += 1000
	J:115 = 0
	TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 += 7
	TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) -= 10
	BASE:ARG:評判 -= 100
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF
$SELECTEND

VARSET ARG
RETURN 1
