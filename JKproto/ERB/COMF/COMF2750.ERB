@COM_ABLE2750(ARG)
SIF !TFLAG:同室
	RETURN 0
RETURN GLOBAL_COMABLE(2750)

@COM2750(ARG)
VARSET LOCAL
PRINTL 
PRINTFORML %"=" * 107%
;戦う
PRINTL 誰と戦いますか？
FOR LOCAL,1,CHARANUM
	SIF LOCAL == MASTER
		CONTINUE
	SIF !TCVAR:LOCAL:同室 || CFLAG:LOCAL:睡眠 || CFLAG:LOCAL:衰弱 || CFLAG:LOCAL:会话
		CONTINUE
	PRINTFORML [{LOCAL,2}] - %CALLNAME:LOCAL%
NEXT
PRINTL [99] - 戻る
$INPUT_LOOP
INPUT
IF RESULT == 99
	RETURN 0
ELSEIF EXISTCSV(RESULT,0) && TCVAR:RESULT:同室
	PRINTFORML %CALLNAME:1%は%CALLNAME:RESULT%に戦闘をしかけた
	;戦い
	J:114 = RESULT
	F:100 = 0
	CALLFORM FIGHT1(ARG,J:114)
	BASE:ARG:評判 -= 10
	J:117 = RESULT
	IF J:117 == 1
		PRINTFORML %CALLNAME:(J:114)%との戦闘に勝ちました
		IF TA:(J:114):ARG:3 > 0
			TA:(J:114):ARG:3 -= 100
		ELSE
			TA:(J:114):ARG:6 += 100
		ENDIF
		IF RAND(3)
			TA:ARG:(J:114):6 += 100
		ELSE
			TA:ARG:(J:114):6 -= 50
		ENDIF
		IF TALENT:(J:114):受虐狂 && RAND(4)
			TA:(J:114):ARG:0 += 20
			TA:(J:114):ARG:2 += 10
			TA:(J:114):ARG:3 += 50
			TA:(J:114):ARG:4 += 100
		ENDIF
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 += 30
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) -= 40
	ELSEIF J:117 == 2
		PRINTFORML %CALLNAME:(J:114)%との戦闘に負けました
		IF TA:ARG:(J:114):3 > 0
			TA:ARG:(J:114):3 -= 30
		ELSE
			TA:ARG:(J:114):6 += 30
		ENDIF
		IF RAND(2)
			TA:(J:114):ARG:6 += 80
		ELSE
			TA:(J:114):ARG:6 -= 20
		ENDIF
		IF TALENT:ARG:受虐狂 && RAND(4)
			TA:ARG:(J:114):0 += 20
			TA:ARG:(J:114):2 += 10
			TA:ARG:(J:114):3 += 50
			TA:ARG:(J:114):4 += 100
		ENDIF
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 -= 14
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) += 3
	ELSEIF J:117 == 3
		PRINTFORML %CALLNAME:1%は逃げ出した
		IF TA:ARG:(J:114):3 > 0
			TA:ARG:(J:114):3 -= 30
		ELSE
			TA:ARG:(J:114):6 += 30
		ENDIF
		IF RAND(2)
			TA:(J:114):ARG:6 += 80
		ELSE
			TA:(J:114):ARG:6 -= 20
		ENDIF
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):1 -= 12
		TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(J:114) += 2
	ENDIF
	CFLAG:ARG:待機時間 += 10
	TA:1:(J:114):0 -= 1000
	TA:1:(J:114):1 -= 10
	TA:1:(J:114):2 -= 10
	TA:(J:114):1:0 -= 1000
	TA:(J:114):1:1 -= 10
	TA:(J:114):1:2 -= 10
	J:117 = 0
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF


VARSET ARG
RETURN 1
