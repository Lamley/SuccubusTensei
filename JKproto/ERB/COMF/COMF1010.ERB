@COM_ABLE1010(ARG)
VARSET LOCAL
LOCAL = ARG
VARSET ARG
SIF !(CFLAG:MASTER:現在地区 == 1) || D:101 || TIME < 750 || TIME > 810
	RETURN 0
SIF GETBIT(CFLAG:LOCAL:食事,1)
	RETURN 0
SIF TCVAR:LOCAL:行為対象 && GETBIT(CFLAG:(TCVAR:ARG:行為対象):食事,1)
	RETURN 0
RETURN GLOBAL_COMABLE(1010)

@COM1010(ARG)
VARSET LOCAL
PRINTL 
PRINTFORML %"=" * 107%
;お昼を食べる
TFLAG:COM用変数 = 0

IF EQUIP:ARG:美味的便当
	DOWNBASE:ARG:体力 -= 600
	DOWNBASE:ARG:气力 -= 800
	EQUIP:ARG:美味的便当--
	TFLAG:COM用変数 = 2
ELSEIF EQUIP:ARG:普通的便当
	DOWNBASE:ARG:体力 -= 200
	DOWNBASE:ARG:气力 -= 300
	EQUIP:ARG:普通的便当--
	TFLAG:COM用変数 = 3
ELSEIF EQUIP:ARG:可怕的便当
	DOWNBASE:ARG:体力 += 50
	DOWNBASE:ARG:气力 += 100
	EQUIP:ARG:可怕的便当--
	TFLAG:COM用変数 = 4
ELSE
	DOWNBASE:ARG:体力 -= 100
	DOWNBASE:ARG:气力 -= 200
	MONEY:ARG -= 500

ENDIF
SETBIT CFLAG:ARG:食事 , 1
IF TCVAR:ARG:行為対象
	IF !(TALENT:(TCVAR:ARG:行為対象):家族)
;相手からの好意が50以上且つ愛情が1以上（又は好意が80以上）、又は、服从が10以上且つ肉欲が120以上
		IF ((TA:(TCVAR:ARG:行為対象):ARG:0 >= 120) && (TA:(TCVAR:ARG:行為対象):ARG:2 >= 10)) | ((TA:(TCVAR:ARG:行為対象):ARG:3 >= 50) && ((TA:(TCVAR:ARG:行為対象):ARG:1 >= 1) | (TA:(TCVAR:ARG:行為対象):ARG:3 >= 80)))
		ELSE
;但し、確率でOK
			A = RAND(900)
			A = A * TA:ARG:(CFLAG:(TCVAR:ARG:行為対象):タイプ):5 / 100
			IF !(A >420)
				PRINTFORML %CALLNAME:(TCVAR:ARG:行為対象)%不想一起吃饭・・・
				B = RAND(100)
				TA:ARG:(TCVAR:ARG:行為対象):4 += 14
				TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):ARG -= 1
				IF B >= 50
					PRINTFORML 逃走了
					TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):ARG -= 1
					CALL EVENT_ESCAPE_ALL
				ENDIF
				CFLAG:MASTER:待機時間 += 15
				VARSET ARG
				M:101 = 0
				RETURN 1
			ENDIF
		ENDIF
	ENDIF

	SETBIT CFLAG:(TCVAR:ARG:行為対象):食事 , 1
	DOWNBASE:(TCVAR:ARG:行為対象):体力 -= 100
	DOWNBASE:(TCVAR:ARG:行為対象):气力 -= 200
	SOURCE:(TCVAR:ARG:行為対象):歓楽 = 400
	EXP:ARG:会话经验 += 4
	EXP:(TCVAR:ARG:行為対象):会话经验 += 4
	SELECTCASE ABL:ARG:说话技巧技能
		CASE 0
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 0.20
		CASE 1
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 0.40
		CASE 2
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 0.70
		CASE 3
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 1.00
		CASE 4
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 1.50
		CASEELSE
			TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 2.00
	ENDSELECT
SIF TFLAG:COM用変数 == 2
	TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 2.00
SIF TFLAG:COM用変数 == 4
	TIMES SOURCE:(TCVAR:ARG:行為対象):歓楽 , 0.70
	TFLAG:COM用変数 = 1
;行為者にも同じ値をセット（好意があるので話しかけたと仮定）
	SOURCE:ARG:歓楽 = SOURCE:(TCVAR:ARG:行為対象):歓楽
;;;20120211 追加　会话成功時に情欲度＋７
	TA:ARG:(TCVAR:ARG:行為対象):4 += 7
	TA:(TCVAR:ARG:行為対象):ARG:4 += 7
	TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):(TCVAR:ARG:行為対象) -= 1
ENDIF

TB:(CFLAG:ARG:現在地区):(CFLAG:ARG:現在位置):ARG += 2

CFLAG:MASTER:待機時間 += 15

M:101 = 0

VARSET ARG
RETURN 1



