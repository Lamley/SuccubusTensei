/*************************************************************************************/
eraTW4.46修正用 画像アニメーション表示5+立ち絵切り替え選択パッチ

eraTW4.46修正用顔グラ立ち絵選択パッチ の案を取り込み
eraTW4.46修正用顔グラパッチ 取り込み

地の文前後で挿絵的に画像をアニメーション表示させるパッチです
表示位置などこんな感じでどうでしょうか、っていう提案版です
立ち絵の位置以外にも画像表示させることができます

eraTW4.46修正にこのパッチ1つで平気です

------------[4→5の変更点]------------

[パッチ]eraTW4.46修正用 キャラ画像スイッチ条件パッチ＋小傘関する修正
・画像について
アンチエイリアスが無くなっています、使えません
あと霊夢、魔理沙他、香霖堂Verのほうだと変化がありすぎたため(別人に感じるので)避けました
本体仕様で一日の中で服を着替えさせることがややこしいため、
ミスティア、響子は、とりあえず保留で
リソースに確保するのもメモリ食いますので、使わないおまけは別フォルダにしてあります
使っていない領域があっても、読み込みで確保されるため

カリスマ変動でレミリアの差分変更を実装
レミリアの立ち絵の方も新規追加、元の方も少し修正

ステータス画面の表示は細かい差分変化を見ないので、
標準画像が表示されるのは仕様でいいかな
レミリアは標準でカリスマのほうです


・オプションについて
【調教SLG】eratoho総合スレ【異常清掃経験224】
>>619
の案を採用
挿絵(現在正常位アニメのほう)のON/OFFをオプションに追加
受精のほうはAAの代わりになりますので、上のオプションになります
初期値OFFになっているはずです

設定数が増えたためOPTIONから専用の設定画面を新設
罫線に無駄なこだわり

正常位アニメ描画関数に挿絵表示フラグ判定設置
PRINT_IMAGEにはないので、呼ぶ前に判定する


・その他
顔絵時の裸眼鏡に対応
顔の定義、慧音の照れが間違っていたのを修正
上海のリソース定義が間違っていたのを修正
【調教SLG】eratoho総合スレ【異常清掃経験224】
>>702
ヘカーティア差分の分リソース定義間違っていたのを修正

------------[3→4の変更点]------------

主に立ち絵と顔グラのゲーム内切り替えを目的とした
リソース定義、描画方法などの変更

ゲーム内で2種の立ち絵の切り替えをしたら、どうなるのかおためし版です
リソースで画像表示するのはそろそろ限界を感じる
使用メモリ500M行きました

今回からeraTW4.46修正用顔グラパッチの画像を同梱させてもらいました
画像をリネーム、一部統合しました

パチュロダ
eraTW4.46修正用顔グラ立ち絵選択パッチ　の案を取り込み
作ってくれた方、ありがとうございます
文字化け、リソースの二重定義等していましたので、作り直します
あとTWの文字コードはSJISとなっていて、パッチもそれに合わせています
やりたいことは恐らく伝わりました


・画像切り替えについて
ゲーム内オプション、または表示設定から行えます


・立ち絵画像について
照れ表現は顔の方に任せる
その代わり立ち絵の方は体勢自由にして、変化を加えられるので
コスパ的に入れないほうがいいかと


・画像ファイルについて
忘れてた、る～こと、カナ、エレンの裸立ち絵追加

顔のほうはキャラIDの後_顔つけてリネーム
番号だと種類がわからんです
入れ替え差分ある場合は最後に番号付ける

これで行くなら仕様ある程度固めて、キャラごとに1ファイルにまとめる
今のやり方だと服追加するだけで、顔の方も座標変えなきゃなので1ファイルにまとめるのはきついか
服差分の4つ分とって、Y軸900から顔固定にするとか
うまいやり方考える

正常位のほうもその内まとめちゃう
まとめました


・服差分について
紫、早苗、鈴仙、幽々子のみ軽く追加してみたので、追加する場合こんな感じでどうだろうか
ファイル分けて、裸2個も作るのは無駄だと思う
裸が変わらないうどんげ、紫などの服パターンは裸の下に
服1として追加する方がいいんじゃなかろうか、と思ってこの形に
慧音の場合髪色まで変わって裸も変わるので別ファイルにしています
ヘカーティアはこれに該当

入れ替え差分
[ヘカーティア]
パッチ作者の条件式を移植　少し改変

服装拡張
[紫]
イブニングドレスなら服1(追加したY3段目)を使う
[早苗]
上がセーラー服なら服1　普段着ないので、着せ替え専用かな　日によって変わるとか追加してもいいかも
[鈴仙]
ブレザーのありなしで判定
[幽々子]
服自体変わらないので1日交代

元々Y軸拡張は服装変更に使ってますので、こんな感じにしました
追加毎にIMAGE.ERBの編集(服装条件式)追記する感じ


・リソース定義について
エクセル的問題でキャラIDをラストにする
立ち絵_服_通常_キャラID
立ち絵の種類(今のところ立ち絵と顔グラか)_服装(Yの段落振り)_表情(Xの段落振り)_キャラID

同じような感じに正常位の方も気に入らなかったので定義も変更


------------[2→3の変更点]------------

オプションから正常位画像の種類を選択できるようになりました
オプションからアニメーションの繰り返し回数を選択できるようになりました
顔グラの照れ表現表示を追加


パチュロダ
[eraT0009556.7z]
[パッチ]eraTW4.46修正用 画像アニメーション表示選択パッチ　適用
作ってくれた方、ありがとうございます
かなり改変しちゃいましたが


・パッチをお手本に種類選択フラグの追加
アニメーションOFF時(静画は表示される)に種類の選択ができないのでフラグ追加

今回正常位の画像3種になりましたので、使用メモリは2MB前後増えたかと思われます

・アニメーションの繰り返し回数、正常位の種類選択を追加
FLAG:アニメーション　は回数兼用にしました
FLAG:正常位画像種類　の方に種類番号入れます


・立ち絵に照れ表現描画を追加
画像位置
540,0,180,180
リソース名
キャラID_照れ
メガネっ娘(マミゾウ、理香子、菫子)も対応
おまけの方は未対応
リソースにも入れていません

前の立ち絵でも照れ表現の変化がないだけで、表示に問題はありません
照れ条件はeraTW4.46修正用顔グラパッチの方の通りにしました


・list.csvのファイル分け
現在の立ち絵のほうは、立ち絵.csvとなりました
ゲームで切り替え方式にするなら、番号付けて、立ち絵のファイルもリネーム
先頭にファイル番号付ける感じかな
とりあえず今のとこ画像ファイル差し替えを前提とした両対応版です

listのほうは汎用で使う画像用
正常位アニメーションとか枠とかのやつ


------------[1→2の変更点]------------

コンドーム装着時の表示制限を変更
中出し以外はゴムありでも表示するように


【調教SLG】eratoho総合スレ【異常清掃経験224】
>>128
の上げてくれた画像ファイル　[その他]正常位受精画像テスト
を使用させて頂きました

画像ファイルver2に対応
今回からファイル名を決めて、それぞれ
正常位.png
受精.png
と、しました
リネームしたので画像ファイルは同梱させてもらいます
またついでに容量節約のためPNGooで圧縮しました、これだけで画像ファイルの容量半分くらい節約しました
編集したい場合は元ファイルからやったほうがいいと思います
こっちの方から直でやる方法もあるけど、色とかアンチ捨てられないかちょっと心配
元はロダにあるから平気かな、表示用と割り切り


正常位の方は正常位01～正常位03のファイル名を正常位にリネームすれば差し替えができると思います
list.csvを編集するよりファイルネーム変えるだけのほうが楽でしたね
デフォは独断と偏見で03のやつです
リソースとして3つ全部読み込んで、ランダムで変化って手もあり
ゲーム内で選択させるなら、無駄が多いのでファイル名変えて差し替えのほうがいいかな
受精のほうはjuseiver2.pngのリネーム、受精.pngで固定

アニメーションをのコマ振りを配列にして、変数にして持っておくか、悩む
正常位アニメーション = 1,2,3,4,3,2,1
みたいな感じの表示順番の配列
もう一個ウエイトのタイミングも必要か、ウエイト一律で同一画像の表示回数で対応するか、悩む
こうしておけば画像差し替えに対応するのが楽になるかな、アニメーションのやり方も変更しやすいかも
現在画像に合わせて連番アニメーション関数呼び出しのベタ書きという、自分にしかわからん感じの書き方


・画像表示枠を追加
軽く作ってみました、画像についてはデザイン変更、色変更など好きにしてくれて平気です
表示設定から枠を表示ONで枠が追加描画されます
ステータス、アニメのほうにも追加されます

ターゲットの場合は水色、ターゲット外の人は灰色
また機嫌によって枠の色が変わる。悪いと赤、良いと青
こちらは立ち絵と違いムードや陥落に左右されません（名前の色が変わるのと同じ感じ）

ターゲットの場合、機嫌の色の見分けがつかなかったので、下半分に機嫌色がつくようにしてみた
マウスオーバーの判定を枠に持たせると立ち絵の表情変化が効かないため断念
表示位置同じで枠のほうが後から描画されているから仕方ないね

レイヤー分けで同一位置に画像表示する場合、
マウスオーバーで変化させられるのは1レイヤーのみとなります

現在の立ち絵描画の仕方
立ち絵
枠
時間停止
の順で描画して、立ち絵をマウスオーバーで変化させています


立ち絵の後ろに描画するのでもいいのですが、お空の立ち絵だと見えなくなっちゃう気がする
フェイスアップにするならなおさら無理か
先に描画する方法で、画像使わない別のやりかたも考えました
rect(四角形)で最初に色ありの184サイズ描画、その後上下左右2ドット縮めたrectで背景色ってやり方
この上に立ち絵画像を表示する
このやり方だと例えば背景画像入れたい、とかになったとき透過効かなくて困るかな
あと枠サイズ分広がるやり方なので透過画像使うにしても微妙……(きっと表示ズれる)
元々の立ち絵に枠分のスペースつければよかったのかもですね

画像にしろrectにしろ、フォントサイズの倍率でしか描画できないので
画像サイズにピッタリ合わせて表示、なんてことはちょっとむずかしそうですね
位置を合わせるにも、左寄せにしないとX軸には融通が効きません
現在の画像ファイルの規則に合わせると、フォント、一行の高さ、どちらも18が一番綺麗に描画されます

------------------------------------------

ゲーム内オプションにて
AA表示を画像表示に変えている状態で、表示がされます
またオプションでアニメーションのON/OFFができます
ゲーム中に立ち絵の画像表示も切っている場合、正常位の挿絵の方も表示されません
別々にフラグ持たせるか悩む

今のところ着衣挿入でも表示されます
裸限定にしたほうがいいかな？
あと立ち絵のほうでも思ったのですが、ふたなりはどうしよう

作ってる途中で急に受精の方も来たので追加してみた
ゲーム中確認するのは大変そう
こちらはオプションの画像表示ONになっていればAAの代わりに表示

どちらの表示も現在左寄せになっています


・画像作ってくれる方々へ
残念ですが、Emueraはgifはそのまま使えないようです
bmp、jpg、pngのみのようです
あと立ち絵は6個割になっていますが、表示の方は6個じゃなくても平気です

追記
gif表示、試してみたらできちゃった……試してみるもんだなぁ
ただしアニメーションは無理みたい（最初のコマだけ静止画で表示された）
アニメーションできないなら、やっぱりPNGのほうがオススメかな


------------------------------------------
[変更ファイル]
\CSV\FLAG.csv
\ERB\SHOP関連\OPTION.ERB
\ERB\ステータス計算関連\SOURCE\SOURCE.ERB
\ERB\ステータス表示関連\IMAGE.ERB
\ERB\イベント関連\妊娠関連\PREGNANCY.ERB
\ERB\コマンド関連\USERCOM.ERB
\resources\list.csv
\resources\2.png
\resources\3.png
\resources\16.png
\resources\26.png
\resources\31.png
\resources\44.png
\resources\52.png
\resources\66.png
15

[追加ファイル]
\resources\立ち絵画像製作者様の利用規約.txt
\resources\立ち絵画像加工作者.txt
\resources\枠.png
\resources\受精.png
\resources\正常位.png
\resources\立ち絵.csv
\resources\顔.csv
\resources\1～113_顔.png
\resources\16_1.png
\resources\16_顔_1.png(元々の16_顔をこちらに移動)
\resources\17_2.png
\resources\67_顔_2.png
\resources\113_1.png
\resources\113_2.png
\resources\113_顔_1.png
\resources\113_顔_2.png
\おまけ\1_顔_2.png
\おまけ\28_顔.png
\おまけ\88_顔.png

変更15
追加18+113+このREADME.txt
合計147ファイル

[削除対象ファイル]
\resources\正常位01.png
\resources\正常位02.png
\resources\正常位03.png (全て正常位.pngにまとめてリネームされています)
\resources\画像製作者様の利用規約.txt
\resources\画像加工者のREADME.txt
\おまけ\16_顔_2.png(リネーム、resourcesに移動)

------------[2の変更点]------------
[FLAG.csv]
[OPTION.ERB]
アニメーションフラグを追加
枠フラグを追加

[SOURCE.ERB]
表示関数を設置
条件式修正
ゴム射精に対応するために変数を増設

[IMAGE.ERB]
リソースの表示を整理
時間停止処理追加
アニメーションに関する関数追加
正常位射精後の表示関数を追加
ちょこちょこ修正とかしてます
コード汚くて申し訳ない

[PREGNANCY.ERB]
表示関数を設置

[USERCOM.ERB]
3104に枠表示のフラグ切り替えを設置

[list.csv]
フレーム
正常位
受精
のリソース定義を追加


------------[2から3の変更点]------------
[FLAG.csv]
[OPTION.ERB]
アニメーションフラグを繰り返し回数兼用に0～5回
正常位画像種類を追加0～2
画像表示の下に付くように表示変えてみました

[SOURCE.ERB]
2と同じ

[IMAGE.ERB]
照れ表現の追加
枠の描画順を変更　時間停止後にしました
アニメーションに関する関数を整理
繰り返し回数をFLAG:アニメーションにしました

[PREGNANCY.ERB]
繰り返し回数をFLAG値へ変更

[USERCOM.ERB]
2と同じ

[list.csv]
立ち絵を立ち絵.csvに移動
正常位の頭に種類別番号を追加
1～2の正常位リソース定義を追加

[立ち絵.csv]
追加
立ち絵のリソース定義ファイルとしました
照れを追加
リソース名　キャラID_照れ
としました
また眼鏡ありのキャラのみ
キャラID_照れ_眼鏡　を追加

------------[3から4の変更点]------------
[FLAG.csv]
[OPTION.ERB]
FLAGに立ち絵種類を追加
切り替えを追加

[SOURCE.ERB]
正常位の呼び出しを少し変更

[IMAGE.ERB]
服装分岐を追加
リソース定義変更に対応

[PREGNANCY.ERB]
3と同じ

[USERCOM.ERB]
3105に立ち絵種類のフラグ切り替えを設置

[list.csv]
正常位の定義変更

[立ち絵.csv]
定義規則変更
服差分追加

[顔.csv]
顔グラ専用に新設

[おまけフォルダ]
顔グラのおまけでまだ使ってないやつ

------------[4から5の変更点]------------
[FLAG.csv]
[OPTION.ERB]
挿絵表示フラグを新設設置

[SOURCE.ERB]
表示の条件式を変更

[IMAGE.ERB]
眼鏡の条件式を少し変更

[立ち絵.csv]
ヘカーティア差分修正

[顔.csv]
慧音差分修正


/*************************************************************************************/
作者：妄想エロ乙女アリスを書いた人

