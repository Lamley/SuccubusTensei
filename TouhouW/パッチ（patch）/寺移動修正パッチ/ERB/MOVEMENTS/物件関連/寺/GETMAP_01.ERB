@GETMAP_1(ARG)
CALL GETMAP_BASIC(ARG)
;------------------------------------------
;MASTER遠距離移動
;ARG:0	最終目的地
;RETURN 	今回移動するところ
;------------------------------------------
@FARMOVE_1(ARG:0)
;LOCAL一覧
#DIM スタート地点
#DIM 暫定目的地


;現在位置取得
スタート地点 = CFLAG:MASTER:現在位置

;暫定目的地決定
暫定目的地 = ARG:0

$LOOP
;暫定目的地に直接移動できる場合
IF CAN_MOVE(CFLAG:(MASTER):現在位置, 暫定目的地) & 1
	;そこに移動
	RETURN 暫定目的地
ENDIF

;袋小路から行ける場所は固定なので、そこを目指す
SELECTCASE スタート地点
;	CASE 101
;		RETURN 102
	CASE 103
		RETURN 104
	CASE 112
		RETURN 107
	CASE 125,128,132
		RETURN 130
	CASE 133
		RETURN 124
	CASE MAXROOM
		RETURN 101
ENDSELECT

;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
;地点追加時要フォロー（全ケース修正すること）
SELECTCASE 暫定目的地
CASE 101
;山門
	;寺からは境内を目指す
	IF CHK_FOCUS(103,スタート地点,122)
	暫定目的地 = 102
	;霊廟からは大門を目指す
	ELSEIF CHK_FOCUS(124,スタート地点,132)
	暫定目的地 = 123
	ENDIF
CASE 102
;境内
	;3からは4を目指す
	IF (スタート地点 == 103)
		暫定目的地 = 104
	;10.19.20からは6を目指す
	ELSEIF (スタート地点 == 110) || (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 106
	;11.12からは7を目指す
	ELSEIF (スタート地点 == 111) || (スタート地点 == 112)
		暫定目的地 = 107
	;13.16からは10を目指す
	ELSEIF (スタート地点 == 109) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 111
	;霊廟からは山門を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 101
	ELSE
	;それ以外の(直接行けない)場所からは、8を目指す
		暫定目的地 = 108
	ENDIF
CASE 103
;本堂
	;2からは4を目指す
	IF (スタート地点 == 102)
		暫定目的地 = 104
	;10.19.20からは6を目指す
	ELSEIF (スタート地点 == 110) || (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 106
	;5.6.7.21.22からは2を目指す
	ELSEIF (スタート地点 == 105) || (スタート地点 == 106) || (スタート地点 == 107) || (スタート地点 == 121) || (スタート地点 == 122)
		暫定目的地 = 102
	;11.12からは7を目指す
	ELSEIF (スタート地点 == 111) || (スタート地点 == 112)
		暫定目的地 = 107
	;9.13.16からは10を目指す
	ELSEIF (スタート地点 == 109) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 111
	;霊廟からは講堂を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 104
	ELSE
	;それ以外の場所からは、8を目指す
		暫定目的地 = 108
	ENDIF
CASE 104
;講堂
	;6からは3を目指す
	IF (スタート地点 == 106)
		暫定目的地 = 103
	;5.7.21からは2を目指す
	ELSEIF (スタート地点 == 105) || (スタート地点 == 107) || (スタート地点 == 121)
		暫定目的地 = 102
	;10.19.20からは6を目指す
	ELSEIF (スタート地点 == 110) || (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 106
	;9.13.16からは10を目指す
	ELSEIF (スタート地点 == 109) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;11.12からは7を目指す
	ELSEIF (スタート地点 == 111) || (スタート地点 == 112)
		暫定目的地 = 107
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 111
	;霊廟からは境内を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 102
	ELSE
	;それ以外の場所からは、8を目指す
		暫定目的地 = 108
	ENDIF
CASE 105
;経堂
	;11.12からは7を目指す
	IF (スタート地点 == 111) || (スタート地点 == 112)
		暫定目的地 = 107
	;1.4.6.21.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 106) || (スタート地点 == 121) || (スタート地点 == 122)
		暫定目的地 = 102
	;3からは4を目指す
	ELSEIF (スタート地点 == 103)
		暫定目的地 = 104
	;10.19.20からは6を目指す
	ELSEIF (スタート地点 == 110) || (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 106
	;9.13.16からは10を目指す
	ELSEIF (スタート地点 == 109) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 111
	;霊廟からは境内を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 102
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 106
;裏庭
	;1.3,4.5.7.22からは2を目指す
	IF GROUPMATCH(スタート地点,101,103,104,105,107,122)
		暫定目的地 = 102
	;11.12からは7を目指す
	ELSEIF (スタート地点 == 111) || (スタート地点 == 112)
		暫定目的地 = 107
	;9.13.16からは10を目指す
	ELSEIF (スタート地点 == 109) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 109
	;霊廟からは境内を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 102
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 107
;土間
	;8からは11を目指す
	IF (スタート地点 == 108)
		暫定目的地 = 111
	;1.4.5.6.21.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 105) || (スタート地点 == 106) || (スタート地点 == 121) || (スタート地点 == 122)
		暫定目的地 = 102
	;3からは4を目指す
	ELSEIF (スタート地点 == 103)
		暫定目的地 = 104
	;13.16からは10を目指す
	ELSEIF (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;10からは9を目指す
	ELSEIF (スタート地点 == 110)
		暫定目的地 = 109
	;19.20からは6を目指す
	ELSEIF (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 106
	;霊廟からは境内を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 102
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 108
;居間
	;10からは9を目指す
	IF (スタート地点 == 110)
		暫定目的地 = 109
	;6.13.16からは10を目指す
	ELSEIF (スタート地点 == 106) || (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;19.20.21からは6を目指す
	ELSEIF GROUPMATCH(スタート地点, 119, 120, 121)
		暫定目的地 = 106
	;1.4.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 122)
		暫定目的地 = 102
	;2.5.12からは7を目指す
	ELSEIF (スタート地点 == 102) || (スタート地点 == 105) || (スタート地点 == 112)
		暫定目的地 = 107
	;7からは11を目指す
	ELSEIF (スタート地点 == 107)
		暫定目的地 = 111
	;霊廟からは土間を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 107
	;それ以外の場所からは、9を目指す
	ELSE
		暫定目的地 = 109
	ENDIF
CASE 109
;客間
	;6.13.16.19.20からは10を目指す
	IF (スタート地点 == 106) || (スタート地点 == 113) || (スタート地点 == 116) || (スタート地点 == 119) || (スタート地点 == 120)
		暫定目的地 = 110
	;2.21からは6を目指す
	ELSEIF (スタート地点 == 102) || (スタート地点 == 121)
		暫定目的地 = 106
	;1.4.5.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 105) || (スタート地点 == 122)
		暫定目的地 = 102
	;12からは7を目指す
	ELSEIF (スタート地点 == 112)
		暫定目的地 = 107
	;7からは11を目指す
	ELSEIF (スタート地点 == 107)
		暫定目的地 = 111
	;霊廟からは裏庭を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 106
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 110
;縁側
	;8からは9を目指す
	IF (スタート地点 == 108)
		暫定目的地 = 109
	;2.21からは6を目指す
	ELSEIF (スタート地点 == 102) || (スタート地点 == 121)
		暫定目的地 = 106
	;3からは4を目指す
	ELSEIF (スタート地点 == 103)
		暫定目的地 = 104
	;1.4.5.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 105) || (スタート地点 == 122)
		暫定目的地 = 102
	;12からは7を目指す
	ELSEIF (スタート地点 == 112)
		暫定目的地 = 107
	;7からは11を目指す
	ELSEIF (スタート地点 == 107)
		暫定目的地 = 111
	;霊廟からは裏庭を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 106
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 111
;台所
	;2.5.12からは7を目指す
	IF (スタート地点 == 102) || (スタート地点 == 105) || (スタート地点 == 112)
		暫定目的地 = 107
	;1.4.6.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 106) || (スタート地点 == 122)
		暫定目的地 = 102
	;19.20.21からは6を目指す
	ELSEIF (スタート地点 == 119) || (スタート地点 == 120) || (スタート地点 == 121)
		暫定目的地 = 106
	;10からは9を目指す
	ELSEIF (スタート地点 == 110)
		暫定目的地 = 109
	;13.16からは10を目指す
	ELSEIF (スタート地点 == 113) || (スタート地点 == 116)
		暫定目的地 = 110
	;3からは4を目指す
	ELSEIF (スタート地点 == 103)
		暫定目的地 = 104
	;霊廟からは土間を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 107
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 112
;風呂
	;3からは4を目指す
	IF (スタート地点 == 3)
		暫定目的地 = 4
	;1.4.22からは2を目指す
	ELSEIF (スタート地点 == 101) || (スタート地点 == 104) || (スタート地点 == 122)
		暫定目的地 = 102
	;21からは6を目指す
	ELSEIF (スタート地点 == 121)
		暫定目的地 = 106
	;2.5.11からは7を目指す
	ELSEIF (スタート地点 == 102) || (スタート地点 == 105) || (スタート地点 == 111)
		暫定目的地 = 107
	;6.13.16.19.20からは10を目指す
	ELSEIF GROUPMATCH(スタート地点, 106, 113, 119, 120)
		暫定目的地 = 110
	;10からは9を目指す
	ELSEIF (スタート地点 == 110)
		暫定目的地 = 109
	;8からは11を目指す
	ELSEIF (スタート地点 == 108)
		暫定目的地 = 111
	;霊廟からは土間を目指す
	ELSEIF CHK_FOCUS(123,スタート地点,132)
		暫定目的地 = 107
	;それ以外の場所からは、8を目指す
	ELSE
		暫定目的地 = 108
	ENDIF
CASE 113
	;ナズーリン私室に直接行けない場合、10を目指す
	暫定目的地 = 110
CASE 114
	;ムラサ私室に直接行けない場合、8を目指す
	暫定目的地 = 108
CASE 115
	;星私室に直接行けない場合、8を目指す
	暫定目的地 = 108
CASE 116
	;一輪私室に直接行けない場合、10を目指す
	暫定目的地 = 110
CASE 117
	;ぬえ私室に直接行けない場合、8を目指す
	暫定目的地 = 108
CASE 118
	;白蓮私室に直接行けない場合、8を目指す
	暫定目的地 = 108
CASE 119
	;あなた私室に直接行けない場合、6を目指す
	暫定目的地 = 106
CASE 120
	;物置に直接行けない場合、10を目指す
	暫定目的地 = 110
CASE 121
	;墓地に直接行けない場合、6を目指す
	暫定目的地 = 106
CASE 122
	;梵鐘堂に直接行けない場合、2を目指す
	暫定目的地 = 102
CASE 123
	;山門以外の寺からは、山門を目指す
	IF CHK_FOCUS(102,スタート地点,122)
		暫定目的地 = 101
	ELSEIF スタート地点 == 126
		暫定目的地 = 124
	ELSEIF スタート地点 == 130
		暫定目的地 = 126
	ELSEIF GROUPMATCH(スタート地点,125,127,128,128,129,131,132)
			暫定目的地 = 130
	ELSE
		暫定目的地 = 101
	ENDIF
CASE 124
	;寺からは、霊廟正門を目指す
	IF CHK_FOCUS(101,スタート地点,122)
		暫定目的地 = 123
	ELSEIF スタート地点 == 130
		暫定目的地 = 126
	ELSEIF GROUPMATCH(スタート地点,125,127,128,128,129,131,132)
		暫定目的地 = 130
	ELSE
		暫定目的地 = 126
	ENDIF
CASE 125
	暫定目的地 = 130
CASE 126
	;寺からは、霊廟広場を目指す
	IF CHK_FOCUS(101,スタート地点,122)
		暫定目的地 = 124
	ELSEIF スタート地点 == 123
		暫定目的地 = 124
	ELSEIF GROUPMATCH(スタート地点,125,127,128,128,129,131,132)
		暫定目的地 = 130
	ELSE
		暫定目的地 = 130
	ENDIF
CASE 127
	暫定目的地 = 130
CASE 128
	暫定目的地 = 130
CASE 129
	暫定目的地 = 130
CASE 130
	;寺からは、道場を目指す
	IF CHK_FOCUS(101,スタート地点,122)
		暫定目的地 = 126
	ELSEIF スタート地点 == 123
		暫定目的地 = 126
	ELSEIF スタート地点 == 124
		暫定目的地 = 126
	ELSE
		暫定目的地 = 126
	ENDIF
CASE 131
	暫定目的地 = 130
CASE 132
	暫定目的地 = 130
CASE 133
	暫定目的地 = 124
ENDSELECT
GOTO LOOP