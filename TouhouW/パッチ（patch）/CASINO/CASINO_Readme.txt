2016/06/28
eraTW4.37proto紅魔カジノパッチ

紅魔館にカジノを実装する
使用通貨はカリスマ
そのついでに変動為替相場制も実装した
デバッグ起動で今日のカリスマ相場を見ることができる



改造事項
・小作人パッチ第二弾のバグ修正（小作人パッチ自体の内容もそのまま入ってます）
・COM631に紅魔カジノを実装
・カリスマ市場システムを実装
　処理内容は独自に考えましたが
　CALLのタイミングについてはカリスマ市場試験導入パッチを参考にしました
・新システム実装に応じた既存関数の改造
　関数@GOODMORNINGの末尾で「きょうのかりすま」を表示（デバッグ起動限定）
　関数@EVENTEND中に通貨価値の変動処理を追加
　関数@EVENTFIRSTと関数@強くてニューゲーム、関数@UPDATEに通貨価値の初期化処理を追加

コマンド系や既存の関数の改造を除いた新規の関数群は全てまとめてCASINO.ERBに入ってます



使用上の注意点
・対象環境はeraTW4.37protoのバニラ環境
　小作人パッチ第二弾のみを適用している場合にも使用できます
・遊べるだけで景品は無いよ、えっちぃのも無いよ
・カリスマ市場試験導入パッチとはおもいっきり競合します
・適用後に必ずアップデートを行ってください



カジノについて
　カジノ内にヘルプ作ったから見てね
　
　めいどカードは安い額面から開始できるがローリターンで運ゲー
　れみりあダイスは当て続ければ大きいがとにかくコストがかかる運ゲー
　ぱっちぇクイズはおそらく一番堅実だが賭け金固定がネックの運ゲー
　
　対応能力が低いとカモられる、高くてもあまり儲かりはしない



通貨関連システムに関する詳細説明

　標準の交換レートは￥200＝1カリスマ
　流通はプレイヤーに渡った資金、紅魔館自体に多量の通貨準備高があることからこの効果は限定的
　また、この数値は毎日×0.98されて減衰する（半減に1ヶ月程度の時間を要するが流通量は最終的に標準レートに落ち着く）
　人気はそのまんま、通貨の人気、％単位で記録
　￥vsカリスマの構図になるため￥50％、カリスマ200％とかだと￥200×4＝￥800：1カリスマというレートになる
　カリスマ為替市場の変動は主として人気を介して上下させる
　変動状況は毎日の人気の変動の傾向を決定する
　1～9の数値をとり、5が平静、1で暴落、9で暴騰となる
　変動累積は変動状況を切り替えるのに使用する、概ね極端な変動状況ほど短期間で終わる
　また、現在の人気が極端な場合にも確率で変動状況を変更する

変動状況の一覧
９　 暴騰 　4　3日継続
８　大上昇　3　4日
７　 上昇 　2　5日
６　微上昇　1　10日
５　 平静 　0　2日
４　微下降　1　10日
３　 下降 　2　5日
２　大下降　3　4日
１　 暴落 　4　3日



使用変数
MONEY
MONEY:2　プレイヤーの所持カリスマとして使用

FLAG
;紅魔カジノ関連フラグ830-839
;カモられ指数はVIPルーム向けに作ったが仕様固まりきらなくて保留中
830,カモられ指数

831,カリスマ流通
832,カリスマ人気
833,カリスマ変動状況
834,カリスマ変動累積

836,￥流通
837,￥人気
838,￥変動状況
839,￥変動累積

TRAINNAME
631,紅魔カジノ

おまけ
どこにも記載がなくてビビったフラグ
実装前にGREPしてよかったよ
700　獲得パンツ種数？
701　ボーナス獲得管理（実績解除システム）
702　ボーナス獲得管理（実績解除システム）
BIT利用で1フラグに64種類の実績を積めるとはいえ
719程度までは実績解除システム用に空けておくのが無難なのか？
これだけ空けとけば1000種類以上実績作れるし十分と思う



その他の注意書き
・改造や流用は好きにして下さい、ただし有料のものに転用するのはやめてね
・関連イベントやらもどんどん作っておーけーです



つくったひとのつくったもの
・TWまとめ買いパッチ
・TW小作人パッチ
・TW紅魔カジノパッチ



今後の展望というか妄想

・景品システムの実装方法について
　カジノで消費したカリスマの金額をフラグに記録しているのでこれを利用して景品と交換する
　カリスマを購入するだけではなく実際にカジノで遊ばないと交換できないというシステムにできる
　つまりいくら資金をつぎ込んでもそれだけでは景品は渡さぬ！ということだ
　相対的に安めのポイント（≒遊んだ回数）と高額のカリスマを同時に使用して購入するのがよさげかな
　まーそもそも景品が未実装なんですがね

・景品の内容について
　長々書いたが結局は最初のレスに戻ってくるわけだ
　景品きまんねー
　むやみにアイテム増やしてもなーって気もするし



↓↓↓こっから長いので暇な人だけどうぞ↓↓↓











・景品交換自体の仕様を回りくどくする？
　１．ゲームでカリスマを消費してポイントを得る
　２．カリスマとポイントを同時に消費してガチャを回す
　３．ガチャで得たカードを消費して景品を交換する
　
　レミリア単体写真×10で「すぴあ・ざ・ぐんぐにる」と交換だ！とかね
　楽しいっちゃ楽しそうだが実装が壮大にめんどくさいのが欠点やな
　ガチャについて下記コレクションアイテムの項目を参照、種類がおおい方が賑やかでいい
　実装の手間も増すけどな！



・適当に茶菓子シリーズでもつくるか？
　効果はさして高くする必要はないとは思うが
　相手に使えるアイテムだとちょっと楽しいかもね

・れみりあさまの羽
　レミリアの羽の形を模したチョコクッキー
・ふらんちゃんの羽
　フランの羽のアレを模したキャンディ、瓶に入ってる
・さくやワイン
　酒
・めーりんまんじゅう
　おっきな中華まん
　おこちゃまが二個を持って胸にあててめーりん！ってして遊ぶのがお約束
　そのあと食べ物で遊ぶなって美鈴さんに叱られるのまでがセット
・こあくまここあ
　お茶淹れ強化アイテム、甘くておこちゃま向け
　甘党とか無いのよね、このキャラ数で新規に設定すると死ねるけど
・ぱっちぇさんに関してはノーアイデア、どうしよう
　安眠の魔書、使うと強制的に1時間の睡眠をとる（≒効果と経過時間の大きい回復アイテム）とか？
　他が茶菓子のなかでひとりだけ本だとすごく浮くよね



・適当にここでしか入手不能な衣装を設定する
　問題は衣装系の知識とセンスが皆無なこと（思いつけない）
　メイドコスとカジノディーラーコスはそれっぽい



・コレクションアイテム系
　写真、ポストカード？トレカ？？？なんでもいいけどそんな感じのやつ
　レアリティ設定してガチャ的なものにする
　用途？単に眺めるためだけのアイテムよ

キャラ　　　個人　　レミリア、フラン、パチュリー、咲夜、小悪魔、美鈴、メイド妖精、ホフさん
　カード　　弾幕　　レミリア弾幕、フラン弾幕、パチュリー弾幕、咲夜弾幕、小悪魔弾幕、美鈴弾幕、メイド妖精弾幕、
　　　　　　集団　　全員集合、主要六名、姉妹、主従、親友、図書主従、部下三人、メイド長とメイド妖精、メイド妖精とホフさん
　　　　　　スペカ　レミリアスペカ、フランスペカ、パチュリースペカ、咲夜スペカ、落ち込む小悪魔、美鈴スペカ、
　　　　　
　　　　　↑同じのを各もう一セット用意してレアリティの高いサイン＆コメント入りを作る
　　　　　レアリティ
　　　　　個人通常＜弾幕通常＜集団通常＜スペカ通常＜個人サイン入……
　　　　　
　　　　　紅魔館に住まうキャラクターを紹介する的なカード（という設定というだけ）

イベント　姉妹の寝顔、姉妹遊ぶ、姉妹でごはん、姉妹でお茶会、
　カード　姉妹追いかけっこ、姉妹喧嘩、姉妹弾幕
　　　　　親友とお話、親友でお茶会、みんなで大掃除、部下三人でぷち宴会、
　　　　　ちびっことめーりん、侵入者と追いかけっこ、侵入者と弾幕ごっこ、図書泥棒、
　　　　　
　　　　　レミリアファッションショー、フランファッションショー、レミ寝顔、フラン寝顔、
　　　　　月夜のレミリア、おでかけレミリア、館内視察レミリア、お茶会、晩餐会、だんすぱーてー、
　　　　　パチュ研究中、パチュ読書中、パチュ休養中、ドヤれみりゃ、ドヤぱっちぇ、
　　　　　
　　　　　お掃除さくや、お茶淹れさくや、お料理さくや、お裁縫さくや
　　　　　図書整理こあ、門番めーりん、居眠りめーりん、お仕事メイド妖精、
　　　　　叱られめーりん、叱られ小悪魔、叱られメイド妖精
　　　　　
　　　　　紅魔館外見、霧の湖、正門、広間、大図書館、バルコニー、食堂、中庭、メイド妖精詰め所
　　　　　
　　　　　
　　　　　なんとなく分類しておくと
　　　　　施設紹介、部下単独、eraいひと単独、集団系
　　　　　
　　　　　紅魔館の日常のひとこまを紹介する的なカード（という設定というだけ）

フラグを食うのは問題か、erh定義すりゃいいかな
この手のはバリーエーションが命なのだが実装の手間も増大するという
楽しそうだが実装超めんどい



この他
・かりすま人形
　非消費アイテム
　とてもかわいらしいお嬢様のぬいぐるみ
　所有することで「～きょうのかりすま～」を毎日見られるようになる
　これはあってもよさそう、便利だし実装もラク
　ただし実装するなら累積値（≒変動のタイミング）は伏せること

・メイド長の懐中時計
　使用するとTSPが100回復する
　意識してTSPを鍛えてたらあんま枯渇することはないからわりと安めでもいいと思う
　無尽蔵に使えても、と思うなら体力・気力の消費効果をつけておく（身体に負担がかかる）

・紅魔館ティーセット
　所持していると紅茶使用時限定でお茶淹れの効果がさらに上がる
　好感度+1とか微妙な底上げがよい



↓これは単純に効果が強力すぎてあまり面白くない
　実装するなら乱用を防ぐ必要がある
　極端に高価にする、もしくは一周回につき一点限りにするなどの手法で
　使い惜しみしたくなるコレクション用にする手法をとる

・れーう゛ぁていん
　レーヴァテインっぽい何か
　￥もしくはカリスマのどちらかを対象に選んで使用することができる
　対象の人気が200以上であるときに変動状況を強制的に暴落状態にする

・すぴあ・ざ・ぐんぐにる
　スピア・ザ・グングニルっぽい何か
　￥もしくはカリスマのどちらかを対象に選んで使用することができる
　対象の人気が80以下であるときに変動状況を強制的に暴騰状態にする
