@GET_EXISTMOB(ARG)
#FUNCTION
SIF GROUPMATCH(ARG, 3,4,9)
	RETURNF 1

;MASTERが在宅中かつモブと同じ位置にいるならMAIN_MAPを返す
@WITH_MOB()
#FUNCTION
SIF AT_HOME(MASTER) && ROOMDATA:(CFLAG:MASTER:現在位置 % 100) & 場所_モブ
	RETURNF MAIN_MAP

@MOB_YOGORE(ARG)
#FUNCTION
SELECTCASE ARG
	CASE 3
		RETURNF -3
	CASE 4
		SIF !GROUPMATCH(TIME:2,1,6,7)
			RETURNF 1
	CASE 9
		SIF !GROUPMATCH(TIME:2,1,6,7)
			RETURNF 2
ENDSELECT

@MOB_PLACE_3
FOR LOCAL,1,100
	CLEARBIT ROOMDATA:LOCAL,20
	SELECTCASE TIME:2
		CASE 2
			SIF GROUPMATCH(LOCAL,2,6,7,8,9,27)
				ROOMDATA:LOCAL |= 場所_モブ
		CASE 3
			SIF GROUPMATCH(LOCAL,13,14,15)
				ROOMDATA:LOCAL |= 場所_モブ
		CASE 4
			SIF GROUPMATCH(LOCAL,17,18,19)
				ROOMDATA:LOCAL |= 場所_モブ
		CASE 5
			SIF GROUPMATCH(LOCAL,24,25)
				ROOMDATA:LOCAL |= 場所_モブ
		CASE 6
			SIF GROUPMATCH(LOCAL,6,28,30)
				ROOMDATA:LOCAL |= 場所_モブ
			SIF LOCAL == 29 && CFLAG:50:現在位置 != 329
				ROOMDATA:LOCAL |= 場所_モブ
	ENDSELECT
NEXT

@MOB_MESSAGE_3
IF FLAG:70
	PRINTFORML 哥布林们停下了動作…
ELSEIF CFLAG:MASTER:現在位置 == 329
	PRINTFORML 哥布林们照看着猫…
ELSE
	PRINTFORML 哥布林们正在干活…
ENDIF

@MOB_TURNENDEVENT_3
IF !FLAG:70
	IF CFLAG:MASTER:うふふ
		PRINTFORML 被哥布林提醒説这里是公共场所請不要做这种行為
		PRINTFORML %CALLNAME:MASTER%覚得有点尴尬
		BASE:情緒 = 0
		FOR LOCAL,0,CHARANUM
			CALL ENDUFUFU(LOCAL)
		NEXT
		TFLAG:106 = 0
		;MASTERとの接触位置をリセット
		CALL TOUCH_SET(0,0,0,1)
		;はだけフラグをオフ
		TEQUIP:2 = 0
		TEQUIP:上半身はだけ状態 = 0
		;キャラ全員の服再セッティング
		FOR LOCAL,0,CHARANUM
			CALL CLOTHES_SETTING_TRAIN(LOCAL)
			;上衣脱衣済みフラグをオフ
			TEQUIP:LOCAL:5 = 0
		NEXT
	ELSEIF CFLAG:MASTER:現在位置 == 313
		CALL MAKANAI
	ENDIF
ENDIF

@MOB_TURNENDEVENT_4
IF !FLAG:70
	IF CFLAG:MASTER:うふふ
		PRINTFORML 四周看到%CALLNAME:MASTER%們的因幡們乱哄哄的吵鬧了起来、並且聽到動静之後開始聚集了過来
		PRINTFORML 感覚気雰有些不妙……
		BASE:情緒 = 0
		FOR LOCAL,0,CHARANUM
			CALL ENDUFUFU(LOCAL)
		NEXT
		TFLAG:106 = 0
		;MASTERとの接触位置をリセット
		CALL TOUCH_SET(0,0,0,1)
		;はだけフラグをオフ
		TEQUIP:2 = 0
		TEQUIP:上半身はだけ状態 = 0
		;キャラ全員の服再セッティング
		FOR LOCAL,0,CHARANUM
			CALL CLOTHES_SETTING_TRAIN(LOCAL)
			;上衣脱衣済みフラグをオフ
			TEQUIP:LOCAL:5 = 0
		NEXT
	ELSEIF CFLAG:MASTER:現在位置 == 313
		CALL MAKANAI
	ENDIF
ENDIF

@MOB_PLACE_4
FOR LOCAL,1,100
	CLEARBIT ROOMDATA:LOCAL,20
	SELECTCASE TIME:2
		CASE 1 TO 7
			SIF GROUPMATCH(LOCAL,7,8,9,21,22,31)
				ROOMDATA:LOCAL |= 場所_モブ
	ENDSELECT
NEXT


@MOB_PLACE_9
FOR LOCAL,1,100
	CLEARBIT ROOMDATA:LOCAL,20
	IF GROUPMATCH(TIME:2,1,6,7)
		SIF GROUPMATCH(LOCAL,2,3,4,5,13,14,15,23,26,28,29,30,33,38)
			ROOMDATA:LOCAL |= 場所_モブ
	ELSE
		SIF GROUPMATCH(LOCAL,2,3,4,5,13,14,15,23,24,26,28,29,30,31,32,33,38)
			ROOMDATA:LOCAL |= 場所_モブ
	ENDIF
NEXT



@ANIMALNAME()
#FUNCTIONS
SELECTCASE TIME:1 % 25
	;小型哺乳類
	CASE 0
		LOCALS = 狗
	CASE 1
		LOCALS = 猫
	CASE 2
		LOCALS = 考拉
	CASE 3
		LOCALS = 大猩猩
	CASE 4
		LOCALS = 澤西悪魔
	CASE 5
		LOCALS = 鎧鼠
	CASE 6
		LOCALS = 小野猪
	CASE 7
		LOCALS = 水豚
	;大型哺乳類
	CASE 8
		LOCALS = 食蟻獣
	CASE 9
		LOCALS = 馬
	CASE 10
		LOCALS = 牛
	CASE 11
		LOCALS = 羊
	CASE 12
		LOCALS = 羊駝
	CASE 13
		LOCALS = 海豹
	;超大型哺乳類
	CASE 14
		LOCALS = 大象
	CASE 15
		LOCALS = 長頸鹿
	;鳥類
	CASE 16
		LOCALS = 雛雞
	CASE 17
		LOCALS = 企鵝
	CASE 18
		LOCALS = 鯨頭鸛
	CASE 19
	;LOCALS = 僵尸妖精
		LOCALS = 孔雀
	CASE 20
		LOCALS = 鴕鳥
	;爬虫類
	CASE 21
		LOCALS = 鰐魚
	CASE 22
		LOCALS = 科莫多龍
	CASE 23
		LOCALS = 緬甸蟒
	CASE 24
		LOCALS = 象亀
ENDSELECT
RETURNF LOCALS

@MAKANAI
#DIM 気力回復量
#DIM 体力回復量

VARSET LOCAL
IF !DISHTYPE && !TFLAG:まかない && TIME:2 == 3
;吃飯できない人がいるかをチェック
FOR LOCAL,0,CHARANUM
	SIF TCVAR:LOCAL:空腹時刻 - TIME:1 > 0 && CFLAG:LOCAL:現在位置 == CFLAG:MASTER:現在位置
		LOCAL:1 ++
NEXT
IF !LOCAL:1 && !RAND:5
	TFLAG:まかない = 1
	PRINTFORML 被推薦了用%MOB_NAME()%製作的料理
	PRINTFORML 要吃麼？
	CALL ASK_YN
	IF RESULT
		PRINTFORML %CALLNAME:MASTER%断然拒絶了
	ELSE
		SELECTCASE RAND:5
			CASE 0,1
				PRINTFORML 味道馬馬虎虎
				体力回復量 = 100
				気力回復量 = 300
			CASE 2,3
				PRINTFORML 還不錯
				体力回復量 = 150
				気力回復量 = 400
			CASE 4
				PRINTFORML 這個真好吃！
				体力回復量 = 300
				気力回復量 = 500
		ENDSELECT
		PRINTFORMW %CALLNAME:MASTER%\@GET_TARGETNUM() ? 們# \@吃飽了
		TIME += 15
		FOR LOCAL,0,CHARANUM
			IF CFLAG:LOCAL:現在位置 == CFLAG:MASTER:現在位置
				CALL RECOVER(LOCAL,体力回復量,"体力")
				CALL RECOVER(LOCAL,気力回復量,"気力")
				CALL 満腹度上昇(LOCAL,"軽食")
				PRINTFORML 体力+{体力回復量}（%CALLNAME:LOCAL%）
				PRINTFORML 気力+{気力回復量}（%CALLNAME:LOCAL%）
			ENDIF
		NEXT
	ENDIF
ENDIF
ENDIF
@MOB_NAME(ARG)
#FUNCTIONS
SIF !ARG
	ARG = MAIN_MAP
SELECTCASE ARG
CASE 3
	LOCALS = 哥布林
CASE 4
	LOCALS = 因幡
CASE 9
	LOCALS = %ANIMALNAME()%
ENDSELECT
RETURNF LOCALS