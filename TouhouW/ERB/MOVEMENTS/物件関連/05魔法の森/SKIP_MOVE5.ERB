@SKIP_MOVE_5(ARG:0,ARG:1)

;現在位置取得
LOCAL:0 = CFLAG:MASTER:現在位置
SIF ARG:1
	LOCAL = ARG:1

;暫定目的地に直接移動できる場合
IF CAN_MOVE(LOCAL, ARG) & 1
	;そこに移動
	RETURN ARG
ENDIF

;袋小路から行ける場所は固定なので、そこを目指す
SELECTCASE LOCAL
;香霖堂からは魔法之森入口のみ
CASE 502
	RETURN 501
;無縁塚からは再思之道のみ
CASE 506
	RETURN 509
CASE 512 TO 514
	RETURN 511
CASE 526
	RETURN 525
CASE 528,531
	RETURN 530
CASE 534
	RETURN 501
CASE 535 TO 537
	RETURN 534
CASE 541 TO 543
	RETURN 540
ENDSELECT

SIF INRANGE(LOCAL,521, 533) && !INRANGE(ARG,520, 533)
	RETURN 520

;直接移動できない場合、1つ近い位置を暫定目的地に設定し直してループ
;地点追加時要フォロー（全ケース修正すること）
SELECTCASE ARG
	CASE 501
		;魔法之森入口に直接いけないなら岔道を目指す
		RETURN 503
	CASE 502
		;香霖堂に直接いけないなら魔法之森入口を目指す
		RETURN 501
	CASE 503
		IF INRANGE(LOCAL,521,533)
			RETURN 520
		ELSEIF INRANGE(LOCAL,534,537)
			RETURN 501
		ELSE
		;魔法之森広場を目指す
			RETURN 508
		ENDIF
	CASE 506
		RETURN 509
	CASE 507
		SELECTCASE LOCAL:0
			CASE 501 TO 503, 520 TO 530, 540 TO 545
				RETURN 540
			CASE 534
				RETURN 501
			CASEELSE
				RETURN 508
		ENDSELECT
	CASE 508
		SELECTCASE LOCAL:0
			CASE 511 TO 514
				RETURN 510
			CASE 506
				RETURN 509
			CASE 515,501, 502
				RETURN 503
			CASEELSE
				RETURN 507
		ENDSELECT
	CASE 509
		RETURN 508
	CASE 510
		SELECTCASE LOCAL:0
			CASE 512 TO 515
				RETURN 511
			CASEELSE
				RETURN 508
		ENDSELECT
	CASE 511
		RETURN 510
	CASE 512 TO 514
		RETURN 511
	CASE 515
		SELECTCASE LOCAL:0
			CASE 510 TO 514
				RETURN 511
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 520
		SELECTCASE LOCAL:0
			CASE 506 TO 509, 540 TO 545 
				RETURN 540
			CASE 523 TO 531
				RETURN 525
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 521,522
		SELECTCASE LOCAL:0
			CASE 521 TO 533
				RETURN 525
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 523,524
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASE 520 TO 527,529,530
				RETURN 525
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 525
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASEELSE
				RETURN 520
		ENDSELECT
	CASE 526
		RETURN 525
	CASE 528,531
		RETURN 530
	CASE 529
		SELECTCASE LOCAL:0
			CASE 528,531
				RETURN 530
			CASEELSE
				RETURN 525
		ENDSELECT
	CASE 530
		RETURN 525
	CASE 534
		RETURN 501
	CASE 535 TO 537
		RETURN 534
	CASE 540
		SELECTCASE LOCAL:0
			CASE 506 TO 509
				RETURN 507
			CASE 521 TO 533
				RETURN 520
			CASEELSE
				RETURN 503
		ENDSELECT
	CASE 541 TO 543
		RETURN 540
ENDSELECT
