@ESTRUS_CYCLE(ARG)
#FUNCTION
SELECTCASE CFLAG:(ARG:0):900
	;安全日
	CASE 1 TO 2
		RETURNF 15
	CASE 3 TO 4
		RETURNF 30
	CASE 5
		RETURNF 50
	CASE 6
		RETURNF 70
	;危険日
	CASE 7
		RETURNF 150
	CASE 8
		RETURNF 100
	CASE 9
		RETURNF 60
	CASE 10
		RETURNF 40
ENDSELECT



;生理周期文字F関数
;翌日などの状態を参照できる
@ESTRUS_CATEGORY(C_ID, ADD_DAY)
#FUNCTIONS
#DIM C_ID     ;登録番号
#DIM ADD_DAY  ;何日後を参照するか、0なら今日
#DIM CHECK_DAY;実際に参照される日の周期
SIF ADD_DAY < 0
	ADD_DAY = -(ABS(ADD_DAY) % 10)
CHECK_DAY = (CFLAG:C_ID:生理周期 + ADD_DAY + 10) % 10
SIF !CHECK_DAY
	CHECK_DAY = 10
SELECTCASE CHECK_DAY
;安全日
CASE 1 TO 2
	RETURNF "安全日"
CASE 6
	RETURNF "危険日前日"
;危険日
CASE 7
	RETURNF "危険日"
CASE 8
	RETURNF "排卵"
ENDSELECT



;生理周期表示関数
;似たようなのが幾つもあったので全部ここで処理しちゃう
@NEW_CYCLE_PRINT(C_ID, ADD_DAY, OP)
#DIM  C_ID    ;登録番号
#DIM  ADD_DAY ;何日後を参照するか、0なら今日
#DIMS OP      ;オプション、現在「等幅」のみ
#DIMS 表示文  ;表示される内容
VARSET 表示文
IF TALENT:C_ID:妊娠
	SETCOLOR C_PINK
	表示文 '= CLIP_HEART("妊娠")
ELSEIF CFLAG:C_ID:妊娠経過日数
	SETCOLOR C_PINK
	表示文 '= CLIP_HEART("着床済")
ELSEIF !ADD_DAY && TCVAR:C_ID:発情
	SETCOLOR C_PINK
	表示文 '= CLIP_HEART("発情中")
ELSE
	表示文 '= ESTRUS_CATEGORY(C_ID, ADD_DAY)
	SIF !STRLENS(表示文)
		RETURN
	SELECTCASE 表示文
	CASE "危険日"
		SETCOLOR C_PINK
		表示文 '= CLIP_HEART(表示文)
	CASE "排卵", "危険日前日"
		SETCOLOR 0xEE60EE
	CASE "安全日"
		SETCOLOR C_AQUA
	ENDSELECT
ENDIF
IF STRCOUNT(OP, "「等幅」")
	PRINTFORM %表示文, 10, LEFT%
ELSE
	PRINTFORM %表示文%
ENDIF
RESETCOLOR


@CYCLE_PRINT(ARG)
CALL NEW_CYCLE_PRINT(ARG)
RETURN

VARSET LOCAL
IF TALENT:ARG:妊娠
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 妊娠{CFLAG:ARG:妊娠経過日数}日目
	CALL HEART
ELSEIF CFLAG:ARG:妊娠経過日数
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 已受精
	CALL HEART
ELSEIF ESTRUS_CYCLE(ARG) == 150
	SETCOLOR C_PINK
	CALL HEART
	IF TCVAR:ARG:発情
		PRINTFORM 発情中
	ELSE
		PRINTFORM 危険日
	ENDIF
	CALL HEART
ELSEIF ESTRUS_CYCLE(ARG) == 100
	SETCOLOR 0xEE60EE
	PRINTFORM 排卵
ELSEIF ESTRUS_CYCLE(ARG) == 70
	SETCOLOR 0xEE60EE
	PRINTFORM 危険日前日
ELSEIF ESTRUS_CYCLE(ARG) == 15
	SETCOLOR C_AQUA
	PRINTFORM 安全日
ENDIF
RESETCOLOR

@CYCLE_PRINT翌日(ARG)
CALL NEW_CYCLE_PRINT(ARG, 1)
RETURN

VARSET LOCAL
IF TALENT:ARG:妊娠
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 妊娠
	CALL HEART
ELSEIF CFLAG:ARG:妊娠経過日数
	SETCOLOR C_PINK
	CALL HEART
	PRINTFORM 已受精
	CALL HEART
ELSEIF CFLAG:ARG:900 == 6
	SETCOLOR C_PINK
	CALL HEART
	IF TCVAR:ARG:発情
		PRINTFORM 発情中
	ELSE
		PRINTFORM 危険日
	ENDIF
	CALL HEART
ELSEIF CFLAG:ARG:900 == 7
	SETCOLOR 0xEE60EE
	PRINTFORM 排卵
ELSEIF CFLAG:ARG:900 == 5
	SETCOLOR 0xEE60EE
	PRINTFORM 危険日前日
ELSEIF CFLAG:ARG:900 == 10 || CFLAG:ARG:900 == 1
	SETCOLOR C_AQUA
	PRINTFORM 安全日
ENDIF
RESETCOLOR




;@CYCLE_PRINT翌日()を表示崩れしないよう
;テキストを同じ幅で出力するようにしたもの
@PRINT_CYCLE_翌日(キャラ登録番号)
#DIM キャラ登録番号
#DIMS 表示文
CALL NEW_CYCLE_PRINT(キャラ登録番号, 1, "「等幅」")
RETURN

表示文 = 
IF TALENT:キャラ登録番号:妊娠
	SETCOLOR C_PINK
	表示文 = %CLIP_HEART("妊娠")%
ELSE
	SELECTCASE CFLAG:キャラ登録番号:生理周期
	CASE 6
		SETCOLOR C_PINK
		IF TCVAR:キャラ登録番号:発情
			表示文 = %CLIP_HEART("発情中")%
		ELSE
			表示文 = %CLIP_HEART("危険日")%
		ENDIF
	CASE 7
		SETCOLOR 0xEE60EE
		表示文 = 排卵
	CASE 5
		SETCOLOR 0xEE60EE
		表示文 = 危険日前日
	CASE 10, 1
		SETCOLOR C_AQUA
		表示文 = 安全日
	ENDSELECT
ENDIF
PRINTFORM %表示文, 10, LEFT%
RESETCOLOR

