@外出先から帰宅
#DIM DIST_TO_HOME
IF !FLAG:デート相手 && !FLAG:70 && BASE:MASTER:TSP >= TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3
	PRINTL 消費TSP、可以不消耗時間帰宅。
	PRINTL 要使用TSP吗？
	PRINTL [0] 否
	PRINTFORML [1] 是（TSP{TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3}消費）
	INPUT
	IF RESULT == 1
		IF BASE:MASTER:TSP < TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3
			PRINTW TSP不足
		ELSE
			BASE:MASTER:TSP -= TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3
			GOTO WARP
		ENDIF
	ENDIF
ENDIF
IF !FLAG:70
	CALL 帰宅の時間経過
ELSEIF BASE:MASTER:TSP < TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3
	PRINTW TSP不足無法在時間停止的時候回去了
	RETURN -1
ELSE
	BASE:MASTER:TSP -= TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) * 3
ENDIF

$WARP
PRINTFORMW 從\@ CFLAG:MASTER:デート中 != CFLAG:TARGET:デート中 || TARGET == MASTER ? 外出 # 约会 \@中回来了
CALL 守矢神簽デート相手のリセット()
FOR LOCAL,1,CHARANUM
	IF CHK_DATENOW(CFLAG:LOCAL:デート中)
		CALL DATE_EVENT(LOCAL)
		CALL SET_DATE(99,LOCAL)
	ENDIF
NEXT
SIF CHK_DATENOW(CFLAG:MASTER:デート中)
	CALL SET_DATE(99,MASTER)

CFLAG:MASTER:現在位置 = GET_ENTRANCE(MAIN_MAP)

@帰宅の時間経過
;残り時間算出
LOCAL = (GET_DATE_PLACE(CFLAG:MASTER:現在位置)) * 10
IF LOCAL && (TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) - LOCAL) > 0
	;道中の場合
	TIME = TIME + (TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中) - LOCAL)
ELSE
	;デート先到着済みの場合
	TIME = TIME + TIME_REQUIRED(MAIN_MAP,CFLAG:MASTER:デート中)
ENDIF
CALL 守矢神簽デート相手のリセット()

@外出先から誘えるか(ARG)
LOCAL = FLAG:デート相手
IF LOCAL != ARG && LOCAL != MASTER
	PRINTFORM %CALLNAME:LOCAL%
	;気弱系
	IF CFLAG:LOCAL:性格傾向 == 1
		PRINTFORML 抓緊了裙角朝着%CALLNAME:MASTER%搖了搖頭
	;強気系
	ELSEIF CFLAG:LOCAL:性格傾向 == 2
		PRINTFORML 眼光一閃凝視着%CALLNAME:MASTER%
	;坦率系
	ELSEIF CFLAG:LOCAL:性格傾向 == 3
		PRINTFORML 凝視着%CALLNAME:MASTER%訴説到一直想要見面
	;真面目系
	ELSEIF CFLAG:LOCAL:性格傾向 == 4
		PRINTFORML 対着%CALLNAME:MASTER%説道那是不行的
	;其他
	ELSEIF CFLAG:LOCAL:性格傾向 == 5
		PRINTFORML 対着%CALLNAME:MASTER%歎息一声、搖了搖頭
	ENDIF
	PRINTFORMW %CALLNAME:MASTER%は%CALLNAME:ARG%放棄了邀請
	RETURN 0
ENDIF
IF ARG == 93 && !ITEM:簡易泳池
	PRINTW 没办法帯她出去…
	RETURN 0
ELSEIF BASE:ARG:気力 < 500
	PRINTFORMW %CALLNAME:ARG%好像太累了
	RETURN 0
ELSEIF !CHARA_HOLIDAY(ARG) && BASE:ARG:工作量 && TCVAR:ARG:仕事開始 < TIME + 180
	PRINTFORMW %CALLNAME:ARG%之後還有工作
	RETURN 0
ELSE
	CFLAG:ARG:拠点来訪 = 1
	RETURN 1
ENDIF


;FileName_DATE_CMN.ERB ------------------------------- Rev1.00
;デートに誘えるか
;-----------------------------------------------------------
@CAN_DATE(ARG)
#FUNCTION

SIF !CHK_DATENOW(CFLAG:MASTER:デート中)
	RETURNF 0
SIF !SHIRAHU(ARG)
	RETURNF 0
SIF CFLAG:MASTER:現在位置 == OMANEKIBEYA()
	RETURNF 0
SIF FLAG:デート相手
	RETURNF 0
SIF !VISIT(ARG)
	RETURNF 0
SIF !CFLAG:ARG:態度
	RETURNF 0
SIF CFLAG:ARG:ブチギレ
	RETURNF 0
SIF CFLAG:ARG:行動 == 5
	RETURNF 0
SIF CHK_DATENOW(CFLAG:ARG:デート中)
	RETURNF 0

RETURNF 1